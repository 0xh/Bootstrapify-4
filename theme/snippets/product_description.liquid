{% if settings.product_description_tabs and product_description.description contains '<h2' %}

  {% assign tab_count = 0 %}
  {% assign tab_title_list = '|' %}
  {% capture tab_titles %}{% endcapture %}
  {% capture tab_contents %}{% endcapture %}

  {% assign tabs = product_description.description | split: '<h2' %}
  {% for tab in tabs %}
    {% assign tab_parts = tab | split: '</h2>' %}
    {% assign tab_title = tab_parts.first | split: '>' | last %}
    {% assign tab_handle = tab_title | handleize %}
    {% capture tab_content %}
      {% comment %}{{ tab_parts.first | prepend: '<h2' | append: '</h2>' }}{% endcomment %}
      {{ tab_parts.last }}
    {% endcapture %}
    
    {% if tab_title == blank %}
      {% assign first_block = tab_parts.last %}
    {% else %}
      {% assign tab_count = tab_count | plus: 1 %}
      {% assign tab_title_list = tab_title_list | prepend: '|' | prepend: tab_handle %}

      {% capture tab_titles %}
        {{ tab_titles }}
        <li{% if tab_count == 1 %} class="active"{% endif %}><a href="#{{ tab_handle | prepend: 'tab-' }}" data-toggle="tab">{{ tab_title }}</a></li>
      {% endcapture %}

      {% capture tab_contents %}
        {{ tab_contents }}
        <div class="tab-pane fade{% if tab_count == 1 %} in active{% endif %}" id="{{ tab_handle | prepend: 'tab-' }}">
          {{ tab_content }}
        </div>
      {% endcapture %}
    {% endif %}
  {% endfor %}
  
  {{ first_block }}
  
  <ul class="nav nav-tabs">
    {{ tab_titles }}
  </ul>
  <div class="tab-content">
    {{ tab_contents }}
  </div>
{% else %}
  <div itemprop="description">{{ product_description.description }}</div>
{% endif %}
{% comment %} TODO: product tags, vendor, type, etc. {% endcomment %}