{% comment note:

  The `nav_list` snippet takes a linklist handle as it's 'with' parameter. You can still create a `nav_list` without this parameter.
  It also has several other optional variable parameters that are set outside the snippet before it is included.
  These are:
  
  nav_classes:
    `nav_classes` is set prior to including this snippet and is used for adding special/bootstrap/context classes to the nav.
    A class of .nav will always be used and if nav_classes is not set before including then this will be the only class used.
  
  nav_list_items:
    This is a comer separated list of extra items to include in this nav list. An option will only be used if it is included in the list.
    options are:
      `accounts`: Show user account links i.e. sign in / sign out / etc.
      `cart`: Show the shopping cart link.
      
  include_dropdowns:
    `include_dropdowns` is a boolean value and defaults to true. When it is enabled it will add a nested dropdown list to the nav.
  
 %}{% endcomment %}

{% assign nav_classes = nav_classes | replace: ',',' ' | replace: '  ',' ' %}
{% unless nav_classes contains 'nav ' %}
  {% assign nav_classes = nav_classes | prepend: 'nav ' %}
{% endunless %}

{% if include_dropdowns == null %}{% assign include_dropdowns = true %}{% endif %}

<ul class="{{ nav_classes }}">
  {% comment note: Create nav links from our linklist handel %}{% endcomment %}
  {% for link in linklists[nav_list].links %}
    {% assign child_list_handle = link.handle %}
    {% if linklists[child_list_handle].links != blank and include_dropdowns %}
      <li class="dropdown">
        <a class="dropdown-toggle" href="{{ link.url }}" data-toggle="dropdown">{{ link.title }} <span class="caret"></span></a>
        <ul class="dropdown-menu" role="menu">
          {% for childlink in linklists[child_list_handle].links %}
            <li{% if childlink.active %} class="active"{% endif %}><a href="{{ childlink.url }}" title="{{ childlink.title }}">{{ childlink.title }}</a></li>
          {% endfor %}
        </ul>
      </li>
    {% else %}
      <li{% if link.active %} class="active"{% endif %}><a href="{{ link.url }}" title="{{ link.title }}">{{ link.title }}</a></li>
    {% endif %}
  {% endfor %}
  
  {% comment note: Show extra nav list items %}{% endcomment %}
  {% assign extra_items = nav_list_items | split: ',' %}
  {% for item in extra_items %}
    {% case item %}
    {% when 'accounts' %}
      {% if shop.customer_accounts_enabled %}
        {% if customer %}        
          <li class="navigation-account">
            <a href="/account">{{ 'customer_accounts.site_header.customer_account_link_html' | t: name: customer.first_name }}</a>
          </li>
          <li class="navigation-account">
            {{ 'customer_accounts.site_header.customer_sign_out_link_html' | t | customer_logout_link }}
          </li>
        {% else %}
          <li class="navigation-account">
            {{ 'customer_accounts.site_header.customer_sign_in_link_html' | t | customer_login_link }}
          </li>
          <li class="navigation-account">
            {{ 'customer_accounts.site_header.customer_register_link_html' | t | customer_register_link }}
          </li>
        {% endif %}
      {% endif %}
      
    {% when 'cart' %}
      {% capture cart_total_price %}{% include '_price' with cart.total_price %}{% endcapture %}
      {% capture cart_total_price_with_currency %}{% include '_price_with_currency' with cart.total_price %}{% endcapture %}
      <li class="navigation-cart"><a href="/cart" data-cart-display>{{ 'cart.site_header.cart_link_html' | t: item_count: cart.item_count, cart_total_price: cart_total_price, cart_total_price_with_currency: cart_total_price_with_currency }}</a></li>
      
    {% endcase %}
  {% endfor %}
</ul>

{% comment note: unset optional variable parameters. Because sanity. %}{% endcomment %}
{% assign nav_list_items = null %}
{% assign nav_classes = null %}
{% assign include_dropdowns = null %}