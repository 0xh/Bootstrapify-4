(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.app = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
Bsify=require("./bsify.js"),CartJS=require("./../../bower_components/shopify-cartjs/dist/cart.js");var App=function(){CartJS.init(Bsify.cart,Bsify.money_formats),Bsify.product&&(Bsify.ImageSwitcher.preload_product_thumbs(),Bsify.ImageSwitcher.image_swticher(),Bsify.VariantOptionSwitcher.image_variant_switcher(),Bsify.linked_product_options&&Bsify.product.available&&Bsify.product.options.length>1&&Bsify.LinkedProductOptions.linkOptionSelectors(Bsify.product)),Bsify.ajax_add_to_cart&&Bsify.Cart.init()},app=new App;module.exports=app;


},{"./../../bower_components/shopify-cartjs/dist/cart.js":2,"./bsify.js":5}],2:[function(require,module,exports){
(function(){var t,e,r,n,a,u,i=function(t,e){return function(){return t.apply(e,arguments)}};e=function(){function t(){this.update=i(this.update,this)}return t.prototype.update=function(t){var e,r,a;for(r in t)a=t[r],"items"!==r&&(this[r]=a);return this.items=function(){var r,a,u,i;for(u=t.items,i=[],r=0,a=u.length;a>r;r++)e=u[r],i.push(new n(e));return i}()},t}(),n=function(){function t(t){this.propertyArray=i(this.propertyArray,this),this.update=i(this.update,this),this.update(t)}return t.prototype.update=function(t){var e,n;for(e in t)n=t[e],"properties"!==e&&(this[e]=n);return this.properties=r.Utils.extend({},t.properties)},t.prototype.propertyArray=function(){var t,e,r,n;r=this.properties,n=[];for(t in r)e=r[t],n.push({name:t,value:e});return n},t}(),r={settings:{dataAPI:!0,requestBodyClass:null,rivetsModels:{},moneyFormat:null,moneyWithCurrencyFormat:null},cart:new e},r.init=function(t,e){return null==e&&(e={}),r.configure(e),r.cart.update(t),r.settings.dataAPI&&r.Data.init(),r.settings.requestBodyClass&&($(document).on("cart.requestStarted",function(){return $("body").addClass(r.settings.requestBodyClass)}),$(document).on("cart.requestComplete",function(){return $("body").removeClass(r.settings.requestBodyClass)})),r.Rivets.init()},r.configure=function(t){return null==t&&(t={}),r.Utils.extend(r.settings,t)},r.Utils={wrapKeys:function(t,e,r){var n,a,u;null==e&&(e="properties"),u={};for(n in t)a=t[n],u[""+e+"["+n+"]"]=null!=r?r:a;return u},unwrapKeys:function(t,e,r){var n,a,u,i;null==e&&(e="properties"),a={};for(n in t)i=t[n],u=n.replace(""+e+"[","").replace("]",""),a[u]=null!=r?r:i;return a},extend:function(t,e){var r,n;for(r in e)n=e[r],t[r]=n;return t},clone:function(t){var e,r;if(null==t||"object"!=typeof t)return t;r=new t.constructor;for(e in t)r[e]=clone(t[e]);return r},isArray:Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},ensureArray:function(t){return r.Utils.isArray(t)?t:null!=t?[t]:[]},formatMoney:function(t,e){var r;return null!=(null!=(r=window.Shopify)?r.formatMoney:void 0)?Shopify.formatMoney(t,e):t},getSizedImageUrl:function(t,e){var r,n;return null!=(null!=(r=window.Shopify)&&null!=(n=r.Image)?n.getSizedImageUrl:void 0)?Shopify.Image.getSizedImageUrl(t,e):t}},u=[],a=!1,r.Queue={add:function(t,e,n){var i;return null==n&&(n={}),i={url:t,data:e,type:n.type||"POST",dataType:n.dataType||"json",success:r.Utils.ensureArray(n.success),error:r.Utils.ensureArray(n.error),complete:r.Utils.ensureArray(n.complete)},n.updateCart&&i.success.push(r.cart.update),u.push(i),a?void 0:(jQuery(document).trigger("cart.requestStarted",[r.cart]),r.Queue.process())},process:function(){var t;return u.length?(a=!0,t=u.shift(),t.complete=r.Queue.process,jQuery.ajax(t)):(a=!1,void jQuery(document).trigger("cart.requestComplete",[r.cart]))}},r.Core={getCart:function(t){return null==t&&(t={}),t.type="GET",t.updateCart=!0,r.Queue.add("/cart.js",{},t)},addItem:function(t,e,n,a){var u;return null==e&&(e=1),null==n&&(n={}),null==a&&(a={}),u=r.Utils.wrapKeys(n),u.id=t,u.quantity=e,r.Queue.add("/cart/add.js",u,a),r.Core.getCart()},updateItem:function(t,e,n,a){var u;return null==n&&(n={}),null==a&&(a={}),u=r.Utils.wrapKeys(n),u.line=t,null!=e&&(u.quantity=e),a.updateCart=!0,r.Queue.add("/cart/change.js",u,a)},removeItem:function(t,e){return null==e&&(e={}),r.Core.updateItem(t,0,{},e)},updateItemById:function(t,e,n,a){var u;return null==n&&(n={}),null==a&&(a={}),u=r.Utils.wrapKeys(n),u.id=t,null!=e&&(u.quantity=e),a.updateCart=!0,r.Queue.add("/cart/change.js",u,a)},updateItemQuantitiesById:function(t,e){return null==t&&(t={}),null==e&&(e={}),e.updateCart=!0,r.Queue.add("/cart/update.js",{updates:t},e)},removeItemById:function(t,e){var n;return null==e&&(e={}),n={id:t,quantity:0},e.updateCart=!0,r.Queue.add("/cart/change.js",n,e)},clear:function(t){return null==t&&(t={}),t.updateCart=!0,r.Queue.add("/cart/clear.js",{},t)},getAttribute:function(t,e){return t in r.cart.attributes?r.cart.attributes[t]:e},setAttribute:function(t,e,n){var a;return null==n&&(n={}),a={},a[t]=e,r.Core.setAttributes(a,n)},getAttributes:function(){return r.cart.attributes},setAttributes:function(t,e){return null==t&&(t={}),null==e&&(e={}),e.updateCart=!0,r.Queue.add("/cart/update.js",r.Utils.wrapKeys(t,"attributes"),e)},clearAttributes:function(t){return null==t&&(t={}),t.updateCart=!0,r.Queue.add("/cart/update.js",r.Utils.wrapKeys(r.Core.getAttributes(),"attributes",""),t)},getNote:function(){return r.cart.note},setNote:function(t,e){return null==e&&(e={}),e.updateCart=!0,r.Queue.add("/cart/update.js",{note:t},e)}},t=jQuery(document),r.Data={init:function(){return r.Data.setEventListeners("on"),r.Data.render(null,r.cart)},destroy:function(){return r.Data.setEventListeners("off")},setEventListeners:function(e){return t[e]("click","[data-cart-add]",r.Data.add),t[e]("click","[data-cart-remove]",r.Data.remove),t[e]("click","[data-cart-remove-id]",r.Data.removeById),t[e]("click","[data-cart-update]",r.Data.update),t[e]("click","[data-cart-update-id]",r.Data.updateById),t[e]("click","[data-cart-clear]",r.Data.clear),t[e]("change","[data-cart-toggle]",r.Data.toggle),t[e]("change","[data-cart-toggle-attribute]",r.Data.toggleAttribute),t[e]("submit","[data-cart-submit]",r.Data.submit),t[e]("cart.requestComplete",r.Data.render)},add:function(t){var e;return t.preventDefault(),e=jQuery(this),r.Core.addItem(e.attr("data-cart-add"),e.attr("data-cart-quantity"))},remove:function(t){var e;return t.preventDefault(),e=jQuery(this),r.Core.removeItem(e.attr("data-cart-remove"))},removeById:function(t){var e;return t.preventDefault(),e=jQuery(this),r.Core.removeItemById(e.attr("data-cart-remove-id"))},update:function(t){var e;return t.preventDefault(),e=jQuery(this),r.Core.updateItem(e.attr("data-cart-update"),e.attr("data-cart-quantity"))},updateById:function(t){var e;return t.preventDefault(),e=jQuery(this),r.Core.updateItemById(e.attr("data-cart-update-id"),e.attr("data-cart-quantity"))},clear:function(t){return t.preventDefault(),r.Core.clear()},toggle:function(){var t,e;return t=jQuery(this),e=t.attr("data-cart-toggle"),t.is(":checked")?r.Core.addItem(e):r.Core.removeAll(e)},toggleAttribute:function(){var t,e;return t=jQuery(this),e=t.attr("data-cart-toggle-attribute"),r.Core.setAttribute(e,t.is(":checked")?"Yes":"")},submit:function(t){var e,n,a,u;return t.preventDefault(),e=jQuery(this).serializeArray(),n=void 0,u=void 0,a={},jQuery.each(e,function(t,e){return"id"===e.name?n=e.value:"quantity"===e.name?u=e.value:a[e.name]=e.value}),r.Core.addItem(n,u,r.Utils.unwrapKeys(a))},render:function(t,e){var n;return n={item_count:e.item_count,total_price:e.total_price,total_price_money:r.Utils.formatMoney(e.total_price,r.settings.moneyFormat),total_price_money_with_currency:r.Utils.formatMoney(e.total_price,r.settings.moneyWithCurrencyFormat)},jQuery("[data-cart-render]").each(function(){var t;return t=jQuery(this),t.text(n[t.attr("data-cart-render")])})}},"rivets"in window?(r.Rivets={views:[],init:function(){return r.Rivets.bindViews()},destroy:function(){return r.Rivets.unbindViews()},bindViews:function(){var t;return r.Rivets.unbindViews(),t=r.Utils.extend({cart:r.cart},r.settings.rivetsModels),jQuery("[data-cart-view]").each(function(){return r.Rivets.views.push(rivets.bind(this,t))})},unbindViews:function(){var t,e,n,a;for(a=r.Rivets.views,e=0,n=a.length;n>e;e++)t=a[e],t.unbind();return r.Rivets.views=[]}},rivets.formatters.eq=function(t,e){return t===e},rivets.formatters.lt=function(t,e){return e>t},rivets.formatters.gt=function(t,e){return t>e},rivets.formatters.not=function(t){return!t},rivets.formatters.empty=function(t){return!t.length},rivets.formatters.plus=function(t,e){return parseInt(t)+parseInt(e)},rivets.formatters.minus=function(t,e){return parseInt(t)-parseInt(e)},rivets.formatters.money=function(t){return r.Utils.formatMoney(t,r.settings.moneyFormat)},rivets.formatters.money_with_currency=function(t){return r.Utils.formatMoney(t,r.settings.moneyWithCurrencyFormat)},rivets.formatters.productImageSize=function(t,e){return r.Utils.getSizedImageUrl(t,e)}):r.Rivets={init:function(){},destroy:function(){}},r.factory=function(t){return t.init=r.init,t.configure=r.configure,t.cart=r.cart,t.settings=r.settings,t.addItem=r.Core.addItem,t.updateItem=r.Core.updateItem,t.updateItemById=r.Core.updateItemById,t.updateItemQuantitiesById=r.Core.updateItemQuantitiesById,t.removeItem=r.Core.removeItem,t.removeAll=r.Core.removeAll,t.clear=r.Core.clear,t.getAttribute=r.Core.getAttribute,t.setAttribute=r.Core.setAttribute,t.getAttributes=r.Core.getAttributes,t.setAttributes=r.Core.setAttributes,t.clearAttributes=r.Core.clearAttributes,t.getNote=r.Core.getNote,t.setNote=r.Core.setNote},"object"==typeof exports?r.factory(exports):"function"==typeof define&&define.amd?define(["exports"],function(t){return r.factory(this.CartJS=t),t}):r.factory(this.CartJS={})}).call(this);


},{}],3:[function(require,module,exports){
var Cart={},message_count=0,$cart_display_ele=$("[data-cart-display]"),$cart_table_ele=$(Bsify.selectors.cart.table_selector),$cart_message_ele=$(Bsify.selectors.cart.message_selector);if(Bsify.product)var $product_form_ele=$(Bsify.selectors.product.form_selector),$product_form_button=$product_form_ele.find("input[type=submit]"),$product_form_message_ele=$(Bsify.selectors.product.form_message_selector);Cart.init=function(){$(document).on("cart.requestComplete",function(){Cart.update_cart_display(),Cart.update_cart_table()}),Bsify.product&&$(document).on("submit",Bsify.selectors.product.form_selector,function(t){t.preventDefault();var e=$(t.currentTarget);Cart.add_item_to_cart(e)}),$(document).on("click","[data-remove-item]",function(t){t.preventDefault();var e=$(t.currentTarget);Cart.remove_item_from_cart(e)})},Cart.add_item_to_cart=function(t){var e=Cart.form_values(t.serializeArray()),r={},a=Bsify.get_variant_by_id(e.id),s=Bsify.product.title+Bsify.translations.product.item_title_seperator+a.title;$product_form_button.val(Bsify.translations.product.adding_to_cart_button_text),CartJS.addItem(e.id,e.quantity,r,{success:function(){var t=Bsify.translations.product.after_product_added_message_html.replace("[item_title]",s);Cart.show_message($product_form_message_ele,"success",t),$product_form_button.val(Bsify.translations.product.added_to_cart_button_text)},error:function(t,e,r){console.log("[ERROR] - Add to cart:",t,e,r);var a=Bsify.translations.product.after_product_added_error_message_html.replace("[item_title]",s).replace("[error_message]",r);Cart.show_message($product_form_message_ele,"error",a),$product_form_button.val(Bsify.translations.product.unavailable_button_text)}})},Cart.remove_item_from_cart=function(t){var e=t.closest(Bsify.selectors.cart.item_selector),r=Cart.get_item_by_id(e.data("cart-item")),a=r.product_title+Bsify.translations.product.item_title_seperator+r.variant_title;CartJS.removeItem(t.data("remove-item"),{success:function(){e.hide();var t=Bsify.translations.cart.remove_item_message.replace("[item_title]",a);Cart.show_message($cart_message_ele,"success",t)},error:function(t,e,r){console.log("[ERROR] - Remove item from cart:",t,e,error_thrownn);var s=Bsify.translations.cart.remove_item_error_message.replace("[item_title]",a).replace("[error_message]",r);Cart.show_message($cart_message_ele,"success",s)}})},Cart.update_cart_display=function(){var t=Shopify.formatMoney(CartJS.cart.total_price,Bsify.money_formats.moneyFormat),e=Shopify.formatMoney(CartJS.cart.total_price,Bsify.money_formats.moneyWithCurrencyFormat),r=Bsify.translations.cart.cart_display_text.replace("[item_count]",CartJS.cart.item_count).replace("[cart_total_price]",t).replace("[cart_total_price_with_currency]",e);$cart_display_ele.html(r)},Cart.update_cart_table=function(){0===CartJS.cart.item_count&&($cart_table_ele.hide(),$cart_message_ele.removeClass("hidden").html(Bsify.translations.cart.empty_cart_text))},Cart.show_message=function(t,e,r){message_count++,t.removeClass("hidden").html('<div class="note '+e+" message"+message_count+'">'+r+"</div>"),Cart.remove_message(message_count)},Cart.remove_message=function(t){setTimeout(function(){$(".message"+t).fadeOut(function(){$(this).remove()})},Bsify.message_timeout)},Cart.form_values=function(t){for(var e={},r=0;r<t.length;r++){var a=t[r];e[a.name]=a.value}return e},Cart.get_item_by_id=function(t){"string"==typeof t&&(t=parseInt(t));var e;if(CartJS)for(var r=0;r<CartJS.cart.items.length;r++){var a=CartJS.cart.items[r];a.variant_id===t&&(e=a)}return e},Cart.has_variant=function(t){"string"==typeof t&&(t=parseInt(t));var e=!1;if(CartJS)for(var r=0;r<CartJS.cart.items.length;r++){var a=CartJS.cart.items[r];a.variant_id===t&&(e=!0)}return e},module.exports=Cart;


},{}],4:[function(require,module,exports){
var ImageSwitcher={};ImageSwitcher.preload_product_thumbs=function(){var e=$("[data-gallery-main]"),a=$(e.data("gallery-main"))[0],i=Shopify.Image.imageSize(a.src);e.length>0&&e.each(function(){var e=new Image,a=$(this).attr("href"),r=Shopify.Image.getSizedImageUrl(a,i);e.src=r})},ImageSwitcher.image_swticher=function(){$(document).on("click","[data-gallery-main]",function(e){e.preventDefault();var a=$(e.currentTarget),i=$(a.data("gallery-main"))[0],r=a.attr("href");ImageSwitcher.switch_image(i,r)})},ImageSwitcher.switch_image=function(e,a){if(e&&a){var i=Shopify.Image.imageSize(e.src),r=Shopify.Image.getSizedImageUrl(a,i);e.src!==r&&(e.src=r)}},module.exports=ImageSwitcher;


},{}],5:[function(require,module,exports){
var Bsify=window.Bsify||{};Bsify.get_variant_by_id=function(i){var r;"string"==typeof i&&(i=parseInt(i));for(var s=0;s<Bsify.product.variants.length;s++){var t=Bsify.product.variants[s];t.id===i&&(r=t)}return r},Bsify.Cart=require("./bsify.cart.js"),Bsify.ImageSwitcher=require("./bsify.image_switcher.js"),Bsify.VariantOptionSwitcher=require("./bsify.variant_option_switcher.js"),Bsify.LinkedProductOptions=require("./bsify.linked_product_options.js"),module.exports=Bsify;


},{"./bsify.cart.js":3,"./bsify.image_switcher.js":4,"./bsify.linked_product_options.js":6,"./bsify.variant_option_switcher.js":7}],6:[function(require,module,exports){
var LinkedProductOptions={};LinkedProductOptions.optionsMap={},LinkedProductOptions.updateOptionsInSelector=function(o){var t,n;switch(o){case 0:t="root",n=jQuery(".single-option-selector:eq(0)");break;case 1:t=jQuery(".single-option-selector:eq(0)").val(),n=jQuery(".single-option-selector:eq(1)");break;case 2:t=jQuery(".single-option-selector:eq(0)").val(),t+=" / "+jQuery(".single-option-selector:eq(1)").val(),n=jQuery(".single-option-selector:eq(2)")}var i=n.val();n.empty();var e=LinkedProductOptions.optionsMap[t];if(void 0!==e){for(var p=0;p<e.length;p++){var s=e[p],r=jQuery("<option></option>").val(s).html(s);n.append(r)}jQuery('.swatch[data-option-index="'+o+'"] .swatch-element').each(function(){-1!==jQuery.inArray($(this).attr("data-value"),e)?$(this).removeClass("soldout").show().find(":radio").removeAttr("disabled","disabled").removeAttr("checked"):$(this).addClass("soldout").hide().find(":radio").removeAttr("checked").attr("disabled","disabled")}),-1!==jQuery.inArray(i,e)&&n.val(i),n.trigger("change")}},LinkedProductOptions.linkOptionSelectors=function(o){for(var t=0;t<o.variants.length;t++){var n=o.variants[t];if(n.available){var i;LinkedProductOptions.optionsMap.root=LinkedProductOptions.optionsMap.root||[],LinkedProductOptions.optionsMap.root.push(n.option1),LinkedProductOptions.optionsMap.root=Shopify.uniq(LinkedProductOptions.optionsMap.root),o.options.length>1&&(i=n.option1,LinkedProductOptions.optionsMap[i]=LinkedProductOptions.optionsMap[i]||[],LinkedProductOptions.optionsMap[i].push(n.option2),LinkedProductOptions.optionsMap[i]=Shopify.uniq(LinkedProductOptions.optionsMap[i])),3===o.options.length&&(i=n.option1+" / "+n.option2,LinkedProductOptions.optionsMap[i]=LinkedProductOptions.optionsMap[i]||[],LinkedProductOptions.optionsMap[i].push(n.option3),LinkedProductOptions.optionsMap[i]=Shopify.uniq(LinkedProductOptions.optionsMap[i]))}}LinkedProductOptions.updateOptionsInSelector(0),o.options.length>1&&LinkedProductOptions.updateOptionsInSelector(1),3===o.options.length&&LinkedProductOptions.updateOptionsInSelector(2),jQuery(".single-option-selector:eq(0)").change(function(){return LinkedProductOptions.updateOptionsInSelector(1),3===o.options.length&&LinkedProductOptions.updateOptionsInSelector(2),!0}),jQuery(".single-option-selector:eq(1)").change(function(){return 3===o.options.length&&LinkedProductOptions.updateOptionsInSelector(2),!0})},module.exports=LinkedProductOptions;


},{}],7:[function(require,module,exports){
var VariantOptionSwitcher={};VariantOptionSwitcher.image_variant_switcher=function(){var t=$(Bsify.selectors.product.select_selector);$(document).on("click","[data-variant-id]",function(i){i.preventDefault();var r=$(i.currentTarget);t.val(r.data("variant-id")),VariantOptionSwitcher.update_product_selector_options(t)})},VariantOptionSwitcher.update_product_selector_options=function(t){var i=t.val(),r=Bsify.get_variant_by_id(i);if(r)for(var a=0;a<Bsify.product.options.length;a++){var e="option"+(a+1),n=r[e];$(".single-option-selector:eq("+a+")").val(n).trigger("change")}},module.exports=VariantOptionSwitcher;


},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvc3Rld2FydGtuYXBtYW4vRGV2ZWxvcG1lbnQvU2hvcGlmeS9DbGllbnRzL0xpYW5uQmVsbGlzL3NyYy9qcy9hcHAuanMiLCIvVXNlcnMvc3Rld2FydGtuYXBtYW4vRGV2ZWxvcG1lbnQvU2hvcGlmeS9DbGllbnRzL0xpYW5uQmVsbGlzL2Jvd2VyX2NvbXBvbmVudHMvc2hvcGlmeS1jYXJ0anMvZGlzdC9jYXJ0LmpzIiwiL1VzZXJzL3N0ZXdhcnRrbmFwbWFuL0RldmVsb3BtZW50L1Nob3BpZnkvQ2xpZW50cy9MaWFubkJlbGxpcy9zcmMvanMvYnNpZnkuY2FydC5qcyIsIi9Vc2Vycy9zdGV3YXJ0a25hcG1hbi9EZXZlbG9wbWVudC9TaG9waWZ5L0NsaWVudHMvTGlhbm5CZWxsaXMvc3JjL2pzL2JzaWZ5LmltYWdlX3N3aXRjaGVyLmpzIiwiL1VzZXJzL3N0ZXdhcnRrbmFwbWFuL0RldmVsb3BtZW50L1Nob3BpZnkvQ2xpZW50cy9MaWFubkJlbGxpcy9zcmMvanMvYnNpZnkuanMiLCIvVXNlcnMvc3Rld2FydGtuYXBtYW4vRGV2ZWxvcG1lbnQvU2hvcGlmeS9DbGllbnRzL0xpYW5uQmVsbGlzL3NyYy9qcy9ic2lmeS5saW5rZWRfcHJvZHVjdF9vcHRpb25zLmpzIiwiL1VzZXJzL3N0ZXdhcnRrbmFwbWFuL0RldmVsb3BtZW50L1Nob3BpZnkvQ2xpZW50cy9MaWFubkJlbGxpcy9zcmMvanMvYnNpZnkudmFyaWFudF9vcHRpb25fc3dpdGNoZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNJQSxNQUFRLFFBQVEsY0FDaEIsT0FBUyxRQUFRLHVEQUVqQixJQUFJLEtBQU0sV0FFUixPQUFPLEtBQUssTUFBTSxLQUFNLE1BQU0sZUFHMUIsTUFBTSxVQUVSLE1BQU0sY0FBYyx5QkFDcEIsTUFBTSxjQUFjLGlCQUVwQixNQUFNLHNCQUFzQix5QkFJeEIsTUFBTSx3QkFFSixNQUFNLFFBQVEsV0FBYSxNQUFNLFFBQVEsUUFBUSxPQUFTLEdBQzVELE1BQU0scUJBQXFCLG9CQUFvQixNQUFNLFVBTXZELE1BQU0sa0JBQ1IsTUFBTSxLQUFLLFFBTVgsSUFBTSxHQUFJLElBQ2QsUUFBTyxRQUFVOzs7O0NDdENqQixXQUNFLEdBQUksR0FBVyxFQUFNLEVBQVEsRUFBTSxFQUFZLEVBQzdDLEVBQVMsU0FBUyxFQUFJLEdBQUssTUFBTyxZQUFZLE1BQU8sR0FBRyxNQUFNLEVBQUksWUFFcEUsR0FBTyxXQUNMLFFBQVMsS0FDUCxLQUFLLE9BQVMsRUFBTyxLQUFLLE9BQVEsTUF1QnBDLE1BcEJBLEdBQUssVUFBVSxPQUFTLFNBQVMsR0FDL0IsR0FBSSxHQUFNLEVBQUssQ0FDZixLQUFLLElBQU8sR0FDVixFQUFRLEVBQUssR0FDRCxVQUFSLElBQ0YsS0FBSyxHQUFPLEVBR2hCLE9BQU8sTUFBSyxNQUFRLFdBQ2xCLEdBQUksR0FBSSxFQUFNLEVBQU0sQ0FHcEIsS0FGQSxFQUFPLEVBQUssTUFDWixLQUNLLEVBQUssRUFBRyxFQUFPLEVBQUssT0FBYSxFQUFMLEVBQVcsSUFDMUMsRUFBTyxFQUFLLEdBQ1osRUFBUyxLQUFLLEdBQUksR0FBSyxHQUV6QixPQUFPLE9BSUosS0FJVCxFQUFPLFdBQ0wsUUFBUyxHQUFLLEdBQ1osS0FBSyxjQUFnQixFQUFPLEtBQUssY0FBZSxNQUNoRCxLQUFLLE9BQVMsRUFBTyxLQUFLLE9BQVEsTUFDbEMsS0FBSyxPQUFPLEdBNEJkLE1BekJBLEdBQUssVUFBVSxPQUFTLFNBQVMsR0FDL0IsR0FBSSxHQUFLLENBQ1QsS0FBSyxJQUFPLEdBQ1YsRUFBUSxFQUFLLEdBQ0QsZUFBUixJQUNGLEtBQUssR0FBTyxFQUdoQixPQUFPLE1BQUssV0FBYSxFQUFPLE1BQU0sVUFBVyxFQUFLLGFBR3hELEVBQUssVUFBVSxjQUFnQixXQUM3QixHQUFJLEdBQU0sRUFBTyxFQUFNLENBQ3ZCLEdBQU8sS0FBSyxXQUNaLElBQ0EsS0FBSyxJQUFRLEdBQ1gsRUFBUSxFQUFLLEdBQ2IsRUFBUyxNQUNQLEtBQU0sRUFDTixNQUFPLEdBR1gsT0FBTyxJQUdGLEtBSVQsR0FDRSxVQUNFLFNBQVMsRUFDVCxpQkFBa0IsS0FDbEIsZ0JBQ0EsWUFBYSxLQUNiLHdCQUF5QixNQUUzQixLQUFNLEdBQUksSUFHWixFQUFPLEtBQU8sU0FBUyxFQUFNLEdBaUIzQixNQWhCZ0IsT0FBWixJQUNGLE1BRUYsRUFBTyxVQUFVLEdBQ2pCLEVBQU8sS0FBSyxPQUFPLEdBQ2YsRUFBTyxTQUFTLFNBQ2xCLEVBQU8sS0FBSyxPQUVWLEVBQU8sU0FBUyxtQkFDbEIsRUFBRSxVQUFVLEdBQUcsc0JBQXVCLFdBQ3BDLE1BQU8sR0FBRSxRQUFRLFNBQVMsRUFBTyxTQUFTLG9CQUU1QyxFQUFFLFVBQVUsR0FBRyx1QkFBd0IsV0FDckMsTUFBTyxHQUFFLFFBQVEsWUFBWSxFQUFPLFNBQVMscUJBRzFDLEVBQU8sT0FBTyxRQUd2QixFQUFPLFVBQVksU0FBUyxHQUkxQixNQUhnQixPQUFaLElBQ0YsTUFFSyxFQUFPLE1BQU0sT0FBTyxFQUFPLFNBQVUsSUFHOUMsRUFBTyxPQUNMLFNBQVUsU0FBUyxFQUFLLEVBQU0sR0FDNUIsR0FBSSxHQUFLLEVBQU8sQ0FDSixPQUFSLElBQ0YsRUFBTyxjQUVULElBQ0EsS0FBSyxJQUFPLEdBQ1YsRUFBUSxFQUFJLEdBQ1osRUFBUSxHQUFLLEVBQU8sSUFBTSxFQUFNLEtBQW1CLE1BQVosRUFBbUIsRUFBVyxDQUV2RSxPQUFPLElBRVQsV0FBWSxTQUFTLEVBQUssRUFBTSxHQUM5QixHQUFJLEdBQUssRUFBVyxFQUFjLENBQ3RCLE9BQVIsSUFDRixFQUFPLGNBRVQsSUFDQSxLQUFLLElBQU8sR0FDVixFQUFRLEVBQUksR0FDWixFQUFlLEVBQUksUUFBUSxHQUFLLEVBQU8sSUFBSyxJQUFJLFFBQVEsSUFBSyxJQUM3RCxFQUFVLEdBQTRCLE1BQVosRUFBbUIsRUFBVyxDQUUxRCxPQUFPLElBRVQsT0FBUSxTQUFTLEVBQVEsR0FDdkIsR0FBSSxHQUFLLENBQ1QsS0FBSyxJQUFPLEdBQ1YsRUFBTSxFQUFXLEdBQ2pCLEVBQU8sR0FBTyxDQUVoQixPQUFPLElBRVQsTUFBTyxTQUFTLEdBQ2QsR0FBSSxHQUFLLENBQ1QsSUFBZSxNQUFWLEdBQXFDLGdCQUFYLEdBQzdCLE1BQU8sRUFFVCxHQUFjLEdBQUksR0FBTyxXQUN6QixLQUFLLElBQU8sR0FDVixFQUFZLEdBQU8sTUFBTSxFQUFPLEdBRWxDLE9BQU8sSUFFVCxRQUFTLE1BQU0sU0FBVyxTQUFTLEdBQ2pDLE1BQW1DLHNCQUF6QixTQUFTLEtBQUssSUFFMUIsWUFBYSxTQUFTLEdBQ3BCLE1BQUksR0FBTyxNQUFNLFFBQVEsR0FDaEIsRUFFSSxNQUFULEdBQ00sT0FLWixZQUFhLFNBQVMsRUFBTyxHQUMzQixHQUFJLEVBQ0osT0FBcUUsUUFBckMsT0FBMUIsRUFBTyxPQUFPLFNBQW1CLEVBQUssWUFBYyxRQUNqRCxRQUFRLFlBQVksRUFBTyxHQUUzQixHQUdYLGlCQUFrQixTQUFTLEVBQUssR0FDOUIsR0FBSSxHQUFNLENBQ1YsT0FBbUgsUUFBbkYsT0FBMUIsRUFBTyxPQUFPLFVBQTJDLE9BQXZCLEVBQVEsRUFBSyxPQUFpQixFQUFNLGlCQUE0QixRQUMvRixRQUFRLE1BQU0saUJBQWlCLEVBQUssR0FFcEMsSUFLYixLQUVBLEdBQWEsRUFFYixFQUFPLE9BQ0wsSUFBSyxTQUFTLEVBQUssRUFBTSxHQUN2QixHQUFJLEVBaUJKLE9BaEJlLE9BQVgsSUFDRixNQUVGLEdBQ0UsSUFBSyxFQUNMLEtBQU0sRUFDTixLQUFNLEVBQVEsTUFBUSxPQUN0QixTQUFVLEVBQVEsVUFBWSxPQUM5QixRQUFTLEVBQU8sTUFBTSxZQUFZLEVBQVEsU0FDMUMsTUFBTyxFQUFPLE1BQU0sWUFBWSxFQUFRLE9BQ3hDLFNBQVUsRUFBTyxNQUFNLFlBQVksRUFBUSxXQUV6QyxFQUFRLFlBQ1YsRUFBUSxRQUFRLEtBQUssRUFBTyxLQUFLLFFBRW5DLEVBQU0sS0FBSyxHQUNQLEVBQUosUUFHQSxPQUFPLFVBQVUsUUFBUSx1QkFBd0IsRUFBTyxPQUNqRCxFQUFPLE1BQU0sWUFFdEIsUUFBUyxXQUNQLEdBQUksRUFDSixPQUFLLEdBQU0sUUFLWCxHQUFhLEVBQ2IsRUFBUyxFQUFNLFFBQ2YsRUFBTyxTQUFXLEVBQU8sTUFBTSxRQUN4QixPQUFPLEtBQUssS0FQakIsR0FBYSxNQUNiLFFBQU8sVUFBVSxRQUFRLHdCQUF5QixFQUFPLFVBVS9ELEVBQU8sTUFDTCxRQUFTLFNBQVMsR0FNaEIsTUFMZSxPQUFYLElBQ0YsTUFFRixFQUFRLEtBQU8sTUFDZixFQUFRLFlBQWEsRUFDZCxFQUFPLE1BQU0sSUFBSSxjQUFnQixJQUUxQyxRQUFTLFNBQVMsRUFBSSxFQUFVLEVBQVksR0FDMUMsR0FBSSxFQWNKLE9BYmdCLE9BQVosSUFDRixFQUFXLEdBRUssTUFBZCxJQUNGLE1BRWEsTUFBWCxJQUNGLE1BRUYsRUFBTyxFQUFPLE1BQU0sU0FBUyxHQUM3QixFQUFLLEdBQUssRUFDVixFQUFLLFNBQVcsRUFDaEIsRUFBTyxNQUFNLElBQUksZUFBZ0IsRUFBTSxHQUNoQyxFQUFPLEtBQUssV0FFckIsV0FBWSxTQUFTLEVBQU0sRUFBVSxFQUFZLEdBQy9DLEdBQUksRUFhSixPQVprQixPQUFkLElBQ0YsTUFFYSxNQUFYLElBQ0YsTUFFRixFQUFPLEVBQU8sTUFBTSxTQUFTLEdBQzdCLEVBQUssS0FBTyxFQUNJLE1BQVosSUFDRixFQUFLLFNBQVcsR0FFbEIsRUFBUSxZQUFhLEVBQ2QsRUFBTyxNQUFNLElBQUksa0JBQW1CLEVBQU0sSUFFbkQsV0FBWSxTQUFTLEVBQU0sR0FJekIsTUFIZSxPQUFYLElBQ0YsTUFFSyxFQUFPLEtBQUssV0FBVyxFQUFNLEtBQU8sSUFFN0MsZUFBZ0IsU0FBUyxFQUFJLEVBQVUsRUFBWSxHQUNqRCxHQUFJLEVBYUosT0Faa0IsT0FBZCxJQUNGLE1BRWEsTUFBWCxJQUNGLE1BRUYsRUFBTyxFQUFPLE1BQU0sU0FBUyxHQUM3QixFQUFLLEdBQUssRUFDTSxNQUFaLElBQ0YsRUFBSyxTQUFXLEdBRWxCLEVBQVEsWUFBYSxFQUNkLEVBQU8sTUFBTSxJQUFJLGtCQUFtQixFQUFNLElBRW5ELHlCQUEwQixTQUFTLEVBQVMsR0FRMUMsTUFQZSxPQUFYLElBQ0YsTUFFYSxNQUFYLElBQ0YsTUFFRixFQUFRLFlBQWEsRUFDZCxFQUFPLE1BQU0sSUFBSSxtQkFDdEIsUUFBUyxHQUNSLElBRUwsZUFBZ0IsU0FBUyxFQUFJLEdBQzNCLEdBQUksRUFTSixPQVJlLE9BQVgsSUFDRixNQUVGLEdBQ0UsR0FBSSxFQUNKLFNBQVUsR0FFWixFQUFRLFlBQWEsRUFDZCxFQUFPLE1BQU0sSUFBSSxrQkFBbUIsRUFBTSxJQUVuRCxNQUFPLFNBQVMsR0FLZCxNQUplLE9BQVgsSUFDRixNQUVGLEVBQVEsWUFBYSxFQUNkLEVBQU8sTUFBTSxJQUFJLG9CQUFzQixJQUVoRCxhQUFjLFNBQVMsRUFBZSxHQUNwQyxNQUFJLEtBQWlCLEdBQU8sS0FBSyxXQUN4QixFQUFPLEtBQUssV0FBVyxHQUV2QixHQUdYLGFBQWMsU0FBUyxFQUFlLEVBQU8sR0FDM0MsR0FBSSxFQU1KLE9BTGUsT0FBWCxJQUNGLE1BRUYsS0FDQSxFQUFXLEdBQWlCLEVBQ3JCLEVBQU8sS0FBSyxjQUFjLEVBQVksSUFFL0MsY0FBZSxXQUNiLE1BQU8sR0FBTyxLQUFLLFlBRXJCLGNBQWUsU0FBUyxFQUFZLEdBUWxDLE1BUGtCLE9BQWQsSUFDRixNQUVhLE1BQVgsSUFDRixNQUVGLEVBQVEsWUFBYSxFQUNkLEVBQU8sTUFBTSxJQUFJLGtCQUFtQixFQUFPLE1BQU0sU0FBUyxFQUFZLGNBQWUsSUFFOUYsZ0JBQWlCLFNBQVMsR0FLeEIsTUFKZSxPQUFYLElBQ0YsTUFFRixFQUFRLFlBQWEsRUFDZCxFQUFPLE1BQU0sSUFBSSxrQkFBbUIsRUFBTyxNQUFNLFNBQVMsRUFBTyxLQUFLLGdCQUFpQixhQUFjLElBQUssSUFFbkgsUUFBUyxXQUNQLE1BQU8sR0FBTyxLQUFLLE1BRXJCLFFBQVMsU0FBUyxFQUFNLEdBS3RCLE1BSmUsT0FBWCxJQUNGLE1BRUYsRUFBUSxZQUFhLEVBQ2QsRUFBTyxNQUFNLElBQUksbUJBQ3RCLEtBQU0sR0FDTCxLQUlQLEVBQVksT0FBTyxVQUVuQixFQUFPLE1BQ0wsS0FBTSxXQUVKLE1BREEsR0FBTyxLQUFLLGtCQUFrQixNQUN2QixFQUFPLEtBQUssT0FBTyxLQUFNLEVBQU8sT0FFekMsUUFBUyxXQUNQLE1BQU8sR0FBTyxLQUFLLGtCQUFrQixRQUV2QyxrQkFBbUIsU0FBUyxHQVUxQixNQVRBLEdBQVUsR0FBUSxRQUFTLGtCQUFtQixFQUFPLEtBQUssS0FDMUQsRUFBVSxHQUFRLFFBQVMscUJBQXNCLEVBQU8sS0FBSyxRQUM3RCxFQUFVLEdBQVEsUUFBUyx3QkFBeUIsRUFBTyxLQUFLLFlBQ2hFLEVBQVUsR0FBUSxRQUFTLHFCQUFzQixFQUFPLEtBQUssUUFDN0QsRUFBVSxHQUFRLFFBQVMsd0JBQXlCLEVBQU8sS0FBSyxZQUNoRSxFQUFVLEdBQVEsUUFBUyxvQkFBcUIsRUFBTyxLQUFLLE9BQzVELEVBQVUsR0FBUSxTQUFVLHFCQUFzQixFQUFPLEtBQUssUUFDOUQsRUFBVSxHQUFRLFNBQVUsK0JBQWdDLEVBQU8sS0FBSyxpQkFDeEUsRUFBVSxHQUFRLFNBQVUscUJBQXNCLEVBQU8sS0FBSyxRQUN2RCxFQUFVLEdBQVEsdUJBQXdCLEVBQU8sS0FBSyxTQUUvRCxJQUFLLFNBQVMsR0FDWixHQUFJLEVBR0osT0FGQSxHQUFFLGlCQUNGLEVBQVEsT0FBTyxNQUNSLEVBQU8sS0FBSyxRQUFRLEVBQU0sS0FBSyxpQkFBa0IsRUFBTSxLQUFLLHdCQUVyRSxPQUFRLFNBQVMsR0FDZixHQUFJLEVBR0osT0FGQSxHQUFFLGlCQUNGLEVBQVEsT0FBTyxNQUNSLEVBQU8sS0FBSyxXQUFXLEVBQU0sS0FBSyxzQkFFM0MsV0FBWSxTQUFTLEdBQ25CLEdBQUksRUFHSixPQUZBLEdBQUUsaUJBQ0YsRUFBUSxPQUFPLE1BQ1IsRUFBTyxLQUFLLGVBQWUsRUFBTSxLQUFLLHlCQUUvQyxPQUFRLFNBQVMsR0FDZixHQUFJLEVBR0osT0FGQSxHQUFFLGlCQUNGLEVBQVEsT0FBTyxNQUNSLEVBQU8sS0FBSyxXQUFXLEVBQU0sS0FBSyxvQkFBcUIsRUFBTSxLQUFLLHdCQUUzRSxXQUFZLFNBQVMsR0FDbkIsR0FBSSxFQUdKLE9BRkEsR0FBRSxpQkFDRixFQUFRLE9BQU8sTUFDUixFQUFPLEtBQUssZUFBZSxFQUFNLEtBQUssdUJBQXdCLEVBQU0sS0FBSyx3QkFFbEYsTUFBTyxTQUFTLEdBRWQsTUFEQSxHQUFFLGlCQUNLLEVBQU8sS0FBSyxTQUVyQixPQUFRLFdBQ04sR0FBSSxHQUFRLENBR1osT0FGQSxHQUFTLE9BQU8sTUFDaEIsRUFBSyxFQUFPLEtBQUssb0JBQ2IsRUFBTyxHQUFHLFlBQ0wsRUFBTyxLQUFLLFFBQVEsR0FFcEIsRUFBTyxLQUFLLFVBQVUsSUFHakMsZ0JBQWlCLFdBQ2YsR0FBSSxHQUFRLENBR1osT0FGQSxHQUFTLE9BQU8sTUFDaEIsRUFBWSxFQUFPLEtBQUssOEJBQ2pCLEVBQU8sS0FBSyxhQUFhLEVBQVcsRUFBTyxHQUFHLFlBQWMsTUFBUSxLQUU3RSxPQUFRLFNBQVMsR0FDZixHQUFJLEdBQVcsRUFBSSxFQUFZLENBZS9CLE9BZEEsR0FBRSxpQkFDRixFQUFZLE9BQU8sTUFBTSxpQkFDekIsRUFBSyxPQUNMLEVBQVcsT0FDWCxLQUNBLE9BQU8sS0FBSyxFQUFXLFNBQVMsRUFBRyxHQUNqQyxNQUFrQixPQUFkLEVBQUssS0FDQSxFQUFLLEVBQUssTUFDTSxhQUFkLEVBQUssS0FDUCxFQUFXLEVBQUssTUFFaEIsRUFBVyxFQUFLLE1BQVEsRUFBSyxRQUdqQyxFQUFPLEtBQUssUUFBUSxFQUFJLEVBQVUsRUFBTyxNQUFNLFdBQVcsS0FFbkUsT0FBUSxTQUFTLEVBQUcsR0FDbEIsR0FBSSxFQU9KLE9BTkEsSUFDRSxXQUFjLEVBQUssV0FDbkIsWUFBZSxFQUFLLFlBQ3BCLGtCQUFxQixFQUFPLE1BQU0sWUFBWSxFQUFLLFlBQWEsRUFBTyxTQUFTLGFBQ2hGLGdDQUFtQyxFQUFPLE1BQU0sWUFBWSxFQUFLLFlBQWEsRUFBTyxTQUFTLDBCQUV6RixPQUFPLHNCQUFzQixLQUFLLFdBQ3ZDLEdBQUksRUFFSixPQURBLEdBQVEsT0FBTyxNQUNSLEVBQU0sS0FBSyxFQUFRLEVBQU0sS0FBSywwQkFLdkMsVUFBWSxTQUNkLEVBQU8sUUFDTCxTQUNBLEtBQU0sV0FDSixNQUFPLEdBQU8sT0FBTyxhQUV2QixRQUFTLFdBQ1AsTUFBTyxHQUFPLE9BQU8sZUFFdkIsVUFBVyxXQUNULEdBQUksRUFLSixPQUpBLEdBQU8sT0FBTyxjQUNkLEVBQVMsRUFBTyxNQUFNLFFBQ3BCLEtBQU0sRUFBTyxNQUNaLEVBQU8sU0FBUyxjQUNaLE9BQU8sb0JBQW9CLEtBQUssV0FDckMsTUFBTyxHQUFPLE9BQU8sTUFBTSxLQUFLLE9BQU8sS0FBSyxLQUFNLE9BR3RELFlBQWEsV0FDWCxHQUFJLEdBQU0sRUFBSSxFQUFNLENBRXBCLEtBREEsRUFBTyxFQUFPLE9BQU8sTUFDaEIsRUFBSyxFQUFHLEVBQU8sRUFBSyxPQUFhLEVBQUwsRUFBVyxJQUMxQyxFQUFPLEVBQUssR0FDWixFQUFLLFFBRVAsT0FBTyxHQUFPLE9BQU8sV0FHekIsT0FBTyxXQUFXLEdBQUssU0FBUyxFQUFHLEdBQ2pDLE1BQU8sS0FBTSxHQUVmLE9BQU8sV0FBVyxHQUFLLFNBQVMsRUFBRyxHQUNqQyxNQUFXLEdBQUosR0FFVCxPQUFPLFdBQVcsR0FBSyxTQUFTLEVBQUcsR0FDakMsTUFBTyxHQUFJLEdBRWIsT0FBTyxXQUFXLElBQU0sU0FBUyxHQUMvQixPQUFRLEdBRVYsT0FBTyxXQUFXLE1BQVEsU0FBUyxHQUNqQyxPQUFRLEVBQUUsUUFFWixPQUFPLFdBQVcsS0FBTyxTQUFTLEVBQUcsR0FDbkMsTUFBTyxVQUFTLEdBQUssU0FBUyxJQUVoQyxPQUFPLFdBQVcsTUFBUSxTQUFTLEVBQUcsR0FDcEMsTUFBTyxVQUFTLEdBQUssU0FBUyxJQUVoQyxPQUFPLFdBQVcsTUFBUSxTQUFTLEdBQ2pDLE1BQU8sR0FBTyxNQUFNLFlBQVksRUFBTyxFQUFPLFNBQVMsY0FFekQsT0FBTyxXQUFXLG9CQUFzQixTQUFTLEdBQy9DLE1BQU8sR0FBTyxNQUFNLFlBQVksRUFBTyxFQUFPLFNBQVMsMEJBRXpELE9BQU8sV0FBVyxpQkFBbUIsU0FBUyxFQUFLLEdBQ2pELE1BQU8sR0FBTyxNQUFNLGlCQUFpQixFQUFLLEtBRzVDLEVBQU8sUUFDTCxLQUFNLGFBQ04sUUFBUyxjQUliLEVBQU8sUUFBVSxTQUFTLEdBa0J4QixNQWpCQSxHQUFRLEtBQU8sRUFBTyxLQUN0QixFQUFRLFVBQVksRUFBTyxVQUMzQixFQUFRLEtBQU8sRUFBTyxLQUN0QixFQUFRLFNBQVcsRUFBTyxTQUMxQixFQUFRLFFBQVUsRUFBTyxLQUFLLFFBQzlCLEVBQVEsV0FBYSxFQUFPLEtBQUssV0FDakMsRUFBUSxlQUFpQixFQUFPLEtBQUssZUFDckMsRUFBUSx5QkFBMkIsRUFBTyxLQUFLLHlCQUMvQyxFQUFRLFdBQWEsRUFBTyxLQUFLLFdBQ2pDLEVBQVEsVUFBWSxFQUFPLEtBQUssVUFDaEMsRUFBUSxNQUFRLEVBQU8sS0FBSyxNQUM1QixFQUFRLGFBQWUsRUFBTyxLQUFLLGFBQ25DLEVBQVEsYUFBZSxFQUFPLEtBQUssYUFDbkMsRUFBUSxjQUFnQixFQUFPLEtBQUssY0FDcEMsRUFBUSxjQUFnQixFQUFPLEtBQUssY0FDcEMsRUFBUSxnQkFBa0IsRUFBTyxLQUFLLGdCQUN0QyxFQUFRLFFBQVUsRUFBTyxLQUFLLFFBQ3ZCLEVBQVEsUUFBVSxFQUFPLEtBQUssU0FHaEIsZ0JBQVosU0FDVCxFQUFPLFFBQVEsU0FDWSxrQkFBWCxTQUF5QixPQUFPLElBQ2hELFFBQVEsV0FBWSxTQUFTLEdBRTNCLE1BREEsR0FBTyxRQUFRLEtBQUssT0FBUyxHQUN0QixJQUdULEVBQU8sUUFBUSxLQUFLLGFBR3JCLEtBQUs7Ozs7QUMvakJSLEdBQUksU0FFQSxjQUFnQixFQUdoQixrQkFBb0IsRUFBRSx1QkFDdEIsZ0JBQWtCLEVBQUUsTUFBTSxVQUFVLEtBQUssZ0JBQ3pDLGtCQUFvQixFQUFFLE1BQU0sVUFBVSxLQUFLLGlCQUcvQyxJQUFJLE1BQU0sUUFDUixHQUFJLG1CQUFvQixFQUFFLE1BQU0sVUFBVSxRQUFRLGVBQzlDLHFCQUF1QixrQkFBa0IsS0FBSyxzQkFDOUMsMEJBQTRCLEVBQUUsTUFBTSxVQUFVLFFBQVEsc0JBSTVELE1BQUssS0FBTyxXQUdWLEVBQUUsVUFBVSxHQUFHLHVCQUF3QixXQUVyQyxLQUFLLHNCQUNMLEtBQUssc0JBSUgsTUFBTSxTQUVSLEVBQUUsVUFBVSxHQUFHLFNBQVUsTUFBTSxVQUFVLFFBQVEsY0FBZSxTQUFVLEdBQ3hFLEVBQUUsZ0JBQ0YsSUFBSSxHQUFrQixFQUFFLEVBQUUsY0FDMUIsTUFBSyxpQkFBaUIsS0FLMUIsRUFBRSxVQUFVLEdBQUcsUUFBUyxxQkFBc0IsU0FBVSxHQUN0RCxFQUFFLGdCQUNGLElBQUksR0FBa0IsRUFBRSxFQUFFLGNBQzFCLE1BQUssc0JBQXNCLE1BUS9CLEtBQUssaUJBQW1CLFNBQVUsR0FDaEMsR0FBSSxHQUFTLEtBQUssWUFBWSxFQUFnQixrQkFDMUMsS0FFQSxFQUFVLE1BQU0sa0JBQWtCLEVBQU8sSUFDekMsRUFBYSxNQUFNLFFBQVEsTUFBUSxNQUFNLGFBQWEsUUFBUSxxQkFBdUIsRUFBUSxLQUdqRyxzQkFBcUIsSUFBSSxNQUFNLGFBQWEsUUFBUSw0QkFHcEQsT0FBTyxRQUFRLEVBQU8sR0FBSSxFQUFPLFNBQVUsR0FDekMsUUFBWSxXQUdWLEdBQUksR0FBVSxNQUFNLGFBQWEsUUFBUSxpQ0FBaUMsUUFBUSxlQUFnQixFQUNsRyxNQUFLLGFBQWEsMEJBQTJCLFVBQVcsR0FHeEQscUJBQXFCLElBQUksTUFBTSxhQUFhLFFBQVEsNEJBR3RELE1BQVMsU0FBUyxFQUFPLEVBQWEsR0FDcEMsUUFBUSxJQUFJLHlCQUEwQixFQUFPLEVBQWEsRUFHMUQsSUFBSSxHQUFVLE1BQU0sYUFBYSxRQUFRLHVDQUF1QyxRQUFRLGVBQWdCLEdBQVksUUFBUSxrQkFBbUIsRUFDL0ksTUFBSyxhQUFhLDBCQUEyQixRQUFTLEdBR3RELHFCQUFxQixJQUFJLE1BQU0sYUFBYSxRQUFRLDZCQUsxRCxLQUFLLHNCQUF3QixTQUFVLEdBQ3JDLEdBQUksR0FBaUIsRUFBZ0IsUUFBUSxNQUFNLFVBQVUsS0FBSyxlQUU5RCxFQUFPLEtBQUssZUFBZSxFQUFlLEtBQUssY0FDL0MsRUFBYSxFQUFLLGNBQWdCLE1BQU0sYUFBYSxRQUFRLHFCQUF1QixFQUFLLGFBRTdGLFFBQU8sV0FBVyxFQUFnQixLQUFLLGdCQUNyQyxRQUFXLFdBRVQsRUFBZSxNQUdmLElBQUksR0FBVSxNQUFNLGFBQWEsS0FBSyxvQkFBb0IsUUFBUSxlQUFnQixFQUNsRixNQUFLLGFBQWEsa0JBQW1CLFVBQVcsSUFHbEQsTUFBUyxTQUFVLEVBQU8sRUFBYSxHQUNyQyxRQUFRLElBQUksbUNBQW9DLEVBQU8sRUFBYSxjQUdwRSxJQUFJLEdBQVUsTUFBTSxhQUFhLEtBQUssMEJBQTBCLFFBQVEsZUFBZ0IsR0FBWSxRQUFRLGtCQUFtQixFQUMvSCxNQUFLLGFBQWEsa0JBQW1CLFVBQVcsT0FVdEQsS0FBSyxvQkFBc0IsV0FDekIsR0FBSSxHQUFtQixRQUFRLFlBQVksT0FBTyxLQUFLLFlBQWEsTUFBTSxjQUFjLGFBQ3BGLEVBQWlDLFFBQVEsWUFBWSxPQUFPLEtBQUssWUFBYSxNQUFNLGNBQWMseUJBQ2xHLEVBQW9CLE1BQU0sYUFBYSxLQUFLLGtCQUFrQixRQUFRLGVBQWdCLE9BQU8sS0FBSyxZQUFZLFFBQVEscUJBQXNCLEdBQWtCLFFBQVEsbUNBQW9DLEVBQzlNLG1CQUFrQixLQUFLLElBSXpCLEtBQUssa0JBQW9CLFdBQ1EsSUFBM0IsT0FBTyxLQUFLLGFBQ2QsZ0JBQWdCLE9BQ2hCLGtCQUFrQixZQUFZLFVBQVUsS0FBSyxNQUFNLGFBQWEsS0FBSyxtQkFLekUsS0FBSyxhQUFlLFNBQVUsRUFBYyxFQUFlLEdBQ3pELGdCQUNBLEVBQWEsWUFBWSxVQUFVLEtBQUssb0JBQW9CLEVBQWMsV0FBVyxjQUFjLEtBQUssRUFBUSxVQUNoSCxLQUFLLGVBQWUsZ0JBR3RCLEtBQUssZUFBaUIsU0FBVSxHQUM5QixXQUFXLFdBQ1QsRUFBRSxXQUFXLEdBQVksUUFBUSxXQUMvQixFQUFFLE1BQU0sWUFFVCxNQUFNLGtCQUlYLEtBQUssWUFBYyxTQUFVLEdBRTNCLElBQUssR0FERCxNQUNLLEVBQUksRUFBRyxFQUFJLEVBQUksT0FBUSxJQUFLLENBQ25DLEdBQUksR0FBTyxFQUFJLEVBQ2YsR0FBSyxFQUFLLE1BQVEsRUFBSyxNQUV6QixNQUFPLElBUVQsS0FBSyxlQUFpQixTQUFVLEdBQ0osZ0JBQWYsS0FBeUIsRUFBYSxTQUFTLEdBQzFELElBQUksRUFDSixJQUFJLE9BQ0YsSUFBSyxHQUFJLEdBQUksRUFBRyxFQUFJLE9BQU8sS0FBSyxNQUFNLE9BQVEsSUFBSyxDQUNqRCxHQUFJLEdBQU8sT0FBTyxLQUFLLE1BQU0sRUFDekIsR0FBSyxhQUFlLElBQ3RCLEVBQVksR0FJbEIsTUFBTyxJQUlULEtBQUssWUFBYyxTQUFVLEdBQ0QsZ0JBQWYsS0FBeUIsRUFBYSxTQUFTLEdBQzFELElBQUksSUFBYyxDQUNsQixJQUFJLE9BQ0YsSUFBSyxHQUFJLEdBQUksRUFBRyxFQUFJLE9BQU8sS0FBSyxNQUFNLE9BQVEsSUFBSyxDQUNqRCxHQUFJLEdBQU8sT0FBTyxLQUFLLE1BQU0sRUFDekIsR0FBSyxhQUFlLElBQ3RCLEdBQWMsR0FJcEIsTUFBTyxJQUdULE9BQU8sUUFBVTs7OztBQzVMakIsR0FBSSxpQkFPSixlQUFjLHVCQUF5QixXQUNyQyxHQUFJLEdBQVUsRUFBRSx1QkFDWixFQUFxQixFQUFFLEVBQVEsS0FBSyxpQkFBaUIsR0FDckQsRUFBa0IsUUFBUSxNQUFNLFVBQVUsRUFBbUIsSUFFOUQsR0FBUSxPQUFTLEdBQ2xCLEVBQVEsS0FBSyxXQUNYLEdBQUksR0FBUSxHQUFJLE9BQ1osRUFBTSxFQUFFLE1BQU0sS0FBSyxRQUNuQixFQUFZLFFBQVEsTUFBTSxpQkFBaUIsRUFBSyxFQUNwRCxHQUFNLElBQU0sS0FNbEIsY0FBYyxlQUFpQixXQUM3QixFQUFFLFVBQVUsR0FBRyxRQUFTLHNCQUF1QixTQUFVLEdBQ3ZELEVBQUUsZ0JBQ0YsSUFBSSxHQUFrQixFQUFFLEVBQUUsZUFDdEIsRUFBcUIsRUFBRSxFQUFnQixLQUFLLGlCQUFpQixHQUM3RCxFQUFZLEVBQWdCLEtBQUssT0FDckMsZUFBYyxhQUFhLEVBQW9CLE1BT25ELGNBQWMsYUFBZSxTQUFVLEVBQW9CLEdBQ3pELEdBQUssR0FBdUIsRUFBNUIsQ0FJQSxHQUFJLEdBQWtCLFFBQVEsTUFBTSxVQUFVLEVBQW1CLEtBQzdELEVBQWdCLFFBQVEsTUFBTSxpQkFBaUIsRUFBVyxFQUUxRCxHQUFtQixNQUFRLElBQzdCLEVBQW1CLElBQU0sS0FJN0IsT0FBTyxRQUFVOzs7O0FDaERqQixHQUFJLE9BQVEsT0FBTyxTQU1uQixPQUFNLGtCQUFvQixTQUFVLEdBQ2xDLEdBQUksRUFDc0IsaUJBQWYsS0FBeUIsRUFBYSxTQUFTLEdBRTFELEtBQUssR0FBSSxHQUFJLEVBQUcsRUFBSSxNQUFNLFFBQVEsU0FBUyxPQUFRLElBQUssQ0FDdEQsR0FBSSxHQUFVLE1BQU0sUUFBUSxTQUFTLEVBQ2pDLEdBQVEsS0FBTyxJQUNqQixFQUFtQixHQUd2QixNQUFPLElBSVQsTUFBTSxLQUFPLFFBQVEsbUJBQ3JCLE1BQU0sY0FBZ0IsUUFBUSw2QkFDOUIsTUFBTSxzQkFBd0IsUUFBUSxzQ0FDdEMsTUFBTSxxQkFBdUIsUUFBUSxxQ0FFckMsT0FBTyxRQUFVOzs7O0FDdEJqQixHQUFJLHdCQUNKLHNCQUFxQixjQUVyQixxQkFBcUIsd0JBQTBCLFNBQVMsR0FDdEQsR0FBSSxHQUFLLENBRVQsUUFBUSxHQUNOLElBQUssR0FDSCxFQUFNLE9BQ04sRUFBVyxPQUFPLGdDQUNsQixNQUNGLEtBQUssR0FDSCxFQUFNLE9BQU8saUNBQWlDLE1BQzlDLEVBQVcsT0FBTyxnQ0FDbEIsTUFDRixLQUFLLEdBQ0gsRUFBTSxPQUFPLGlDQUFpQyxNQUM5QyxHQUFPLE1BQVEsT0FBTyxpQ0FBaUMsTUFDdkQsRUFBVyxPQUFPLGlDQUd0QixHQUFJLEdBQWUsRUFBUyxLQUM1QixHQUFTLE9BQ1QsSUFBSSxHQUFtQixxQkFBcUIsV0FBVyxFQUN2RCxJQUF5QixTQUFyQixFQUFnQyxDQUNsQyxJQUFLLEdBQUksR0FBRSxFQUFHLEVBQUUsRUFBaUIsT0FBUSxJQUFLLENBQzVDLEdBQUksR0FBUyxFQUFpQixHQUMxQixFQUFZLE9BQU8scUJBQXFCLElBQUksR0FBUSxLQUFLLEVBQzdELEdBQVMsT0FBTyxHQUVsQixPQUFPLDhCQUFnQyxFQUFnQixzQkFBc0IsS0FBSyxXQUNYLEtBQWpFLE9BQU8sUUFBUSxFQUFFLE1BQU0sS0FBSyxjQUFlLEdBQzdDLEVBQUUsTUFBTSxZQUFZLFdBQVcsT0FBTyxLQUFLLFVBQVUsV0FBVyxXQUFXLFlBQVksV0FBVyxXQUdsRyxFQUFFLE1BQU0sU0FBUyxXQUFXLE9BQU8sS0FBSyxVQUFVLFdBQVcsV0FBVyxLQUFLLFdBQVcsY0FHckMsS0FBbkQsT0FBTyxRQUFRLEVBQWMsSUFDL0IsRUFBUyxJQUFJLEdBRWYsRUFBUyxRQUFRLFlBSXJCLHFCQUFxQixvQkFBc0IsU0FBUyxHQUVsRCxJQUFLLEdBQUksR0FBRSxFQUFHLEVBQUUsRUFBUSxTQUFTLE9BQVEsSUFBSyxDQUM1QyxHQUFJLEdBQVUsRUFBUSxTQUFTLEVBQy9CLElBQUksRUFBUSxVQUFXLENBQ3JCLEdBQUksRUFFSixzQkFBcUIsV0FBVyxLQUFPLHFCQUFxQixXQUFXLFNBQ3ZFLHFCQUFxQixXQUFXLEtBQUssS0FBSyxFQUFRLFNBQ2xELHFCQUFxQixXQUFXLEtBQU8sUUFBUSxLQUFLLHFCQUFxQixXQUFXLE1BRWhGLEVBQVEsUUFBUSxPQUFTLElBQzNCLEVBQU0sRUFBUSxRQUNkLHFCQUFxQixXQUFXLEdBQU8scUJBQXFCLFdBQVcsT0FDdkUscUJBQXFCLFdBQVcsR0FBSyxLQUFLLEVBQVEsU0FDbEQscUJBQXFCLFdBQVcsR0FBTyxRQUFRLEtBQUsscUJBQXFCLFdBQVcsS0FHdkQsSUFBM0IsRUFBUSxRQUFRLFNBQ2xCLEVBQU0sRUFBUSxRQUFVLE1BQVEsRUFBUSxRQUN4QyxxQkFBcUIsV0FBVyxHQUFPLHFCQUFxQixXQUFXLE9BQ3ZFLHFCQUFxQixXQUFXLEdBQUssS0FBSyxFQUFRLFNBQ2xELHFCQUFxQixXQUFXLEdBQU8sUUFBUSxLQUFLLHFCQUFxQixXQUFXLE1BSzFGLHFCQUFxQix3QkFBd0IsR0FDekMsRUFBUSxRQUFRLE9BQVMsR0FBRyxxQkFBcUIsd0JBQXdCLEdBQzlDLElBQTNCLEVBQVEsUUFBUSxRQUFjLHFCQUFxQix3QkFBd0IsR0FFL0UsT0FBTyxpQ0FBaUMsT0FBTyxXQUc3QyxNQUZBLHNCQUFxQix3QkFBd0IsR0FDZCxJQUEzQixFQUFRLFFBQVEsUUFBYyxxQkFBcUIsd0JBQXdCLElBQ3hFLElBR1QsT0FBTyxpQ0FBaUMsT0FBTyxXQUU3QyxNQUQrQixLQUEzQixFQUFRLFFBQVEsUUFBYyxxQkFBcUIsd0JBQXdCLElBQ3hFLEtBS1gsT0FBTyxRQUFVOzs7O0FDN0ZqQixHQUFJLHlCQUdKLHVCQUFzQix1QkFBeUIsV0FFN0MsR0FBSSxHQUFvQixFQUFFLE1BQU0sVUFBVSxRQUFRLGdCQUVsRCxHQUFFLFVBQVUsR0FBRyxRQUFTLG9CQUFxQixTQUFVLEdBQ3JELEVBQUUsZ0JBQ0YsSUFBSSxHQUFrQixFQUFFLEVBQUUsY0FFMUIsR0FBa0IsSUFBSSxFQUFnQixLQUFLLGVBRTNDLHNCQUFzQixnQ0FBZ0MsTUFNMUQsc0JBQXNCLGdDQUFrQyxTQUFVLEdBR2hFLEdBQUksR0FBYSxFQUFrQixNQUMvQixFQUFVLE1BQU0sa0JBQWtCLEVBRXRDLElBQUksRUFFRixJQUFLLEdBQUksR0FBSSxFQUFHLEVBQUksTUFBTSxRQUFRLFFBQVEsT0FBUSxJQUFLLENBQ3JELEdBQUksR0FBUyxVQUFVLEVBQUUsR0FDckIsRUFBUSxFQUFRLEVBQ3BCLEdBQUUsOEJBQThCLEVBQUUsS0FBSyxJQUFJLEdBQU8sUUFBUSxZQUtoRSxPQUFPLFFBQVUiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLypcbiAgTWFpbiBhcHAgZm9yIEJvb3RzdHJhcGlmeVxuKi9cblxuQnNpZnkgPSByZXF1aXJlKCcuL2JzaWZ5LmpzJyk7XG5DYXJ0SlMgPSByZXF1aXJlKFwiLi8uLi8uLi9ib3dlcl9jb21wb25lbnRzL3Nob3BpZnktY2FydGpzL2Rpc3QvY2FydC5qc1wiKTtcblxudmFyIEFwcCA9IGZ1bmN0aW9uICgpIHtcbiAgLy8gaW5pdCBDYXJ0SlNcbiAgQ2FydEpTLmluaXQoQnNpZnkuY2FydCwgQnNpZnkubW9uZXlfZm9ybWF0cyk7XG4gIFxuICAvLyBpbml0IHByb2R1Y3QgdGVtcGxhdGUganNcbiAgaWYgKEJzaWZ5LnByb2R1Y3QpIHtcbiAgICAvLyBQcmVsb2FkIGltYWdlcyBhbmQgY2FsbCBpbWFnZSBzd2l0Y2hlciBpbml0XG4gICAgQnNpZnkuSW1hZ2VTd2l0Y2hlci5wcmVsb2FkX3Byb2R1Y3RfdGh1bWJzKCk7XG4gICAgQnNpZnkuSW1hZ2VTd2l0Y2hlci5pbWFnZV9zd3RpY2hlcigpO1xuICAgIC8vIEluaXRpYWxpc2UgdGhlIGltYWdlX3ZhcmlhbnRfc3dpdGNoZXJcbiAgICBCc2lmeS5WYXJpYW50T3B0aW9uU3dpdGNoZXIuaW1hZ2VfdmFyaWFudF9zd2l0Y2hlcigpO1xuICAgIFxuICAgIC8vIENhbGwgbGlua09wdGlvblNlbGVjdG9yc1xuICAgIC8vIENoZWNrIHRoYXQgd2Ugd2FudCB0byB1c2UgdGhlIGxpbmtlZCBwcm9kdWN0IG9wdGlvbnNcbiAgICBpZiAoQnNpZnkubGlua2VkX3Byb2R1Y3Rfb3B0aW9ucykge1xuICAgICAgLy8gTWFrZSBzdXJlIHRoZSBwcm9kdWN0IG1lZXRzIHRoZSBjb3JyZWN0IGNpdGVyaWEgZm9yIGxpbmtlZCBwcm9kdWN0IG9wdGlvbnMgYW5kIHRoZW4gaW5pdGlhbGlzZVxuICAgICAgaWYgKEJzaWZ5LnByb2R1Y3QuYXZhaWxhYmxlICYmIEJzaWZ5LnByb2R1Y3Qub3B0aW9ucy5sZW5ndGggPiAxKSB7XG4gICAgICAgIEJzaWZ5LkxpbmtlZFByb2R1Y3RPcHRpb25zLmxpbmtPcHRpb25TZWxlY3RvcnMoQnNpZnkucHJvZHVjdCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBpbml0IGFqYXggYWRkIHRvIGNhcnRcbiAgaWYgKEJzaWZ5LmFqYXhfYWRkX3RvX2NhcnQpIHtcbiAgICBCc2lmeS5DYXJ0LmluaXQoKTtcbiAgfVxuICBcbn07XG5cbi8vIGluaXRpYXRlIHRoZSBhcHAgYW5kIGV4cG9zZSBpdCB0byB0aGUgYnJvd3NlclxudmFyIGFwcCA9IG5ldyBBcHAoKTtcbm1vZHVsZS5leHBvcnRzID0gYXBwOyIsIihmdW5jdGlvbigpIHtcbiAgdmFyICRkb2N1bWVudCwgQ2FydCwgQ2FydEpTLCBJdGVtLCBwcm9jZXNzaW5nLCBxdWV1ZSxcbiAgICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9O1xuXG4gIENhcnQgPSAoZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gQ2FydCgpIHtcbiAgICAgIHRoaXMudXBkYXRlID0gX19iaW5kKHRoaXMudXBkYXRlLCB0aGlzKTtcbiAgICB9XG5cbiAgICBDYXJ0LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbihjYXJ0KSB7XG4gICAgICB2YXIgaXRlbSwga2V5LCB2YWx1ZTtcbiAgICAgIGZvciAoa2V5IGluIGNhcnQpIHtcbiAgICAgICAgdmFsdWUgPSBjYXJ0W2tleV07XG4gICAgICAgIGlmIChrZXkgIT09ICdpdGVtcycpIHtcbiAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuaXRlbXMgPSAoZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICAgIF9yZWYgPSBjYXJ0Lml0ZW1zO1xuICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICBpdGVtID0gX3JlZltfaV07XG4gICAgICAgICAgX3Jlc3VsdHMucHVzaChuZXcgSXRlbShpdGVtKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgfSkoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIENhcnQ7XG5cbiAgfSkoKTtcblxuICBJdGVtID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIEl0ZW0oaXRlbSkge1xuICAgICAgdGhpcy5wcm9wZXJ0eUFycmF5ID0gX19iaW5kKHRoaXMucHJvcGVydHlBcnJheSwgdGhpcyk7XG4gICAgICB0aGlzLnVwZGF0ZSA9IF9fYmluZCh0aGlzLnVwZGF0ZSwgdGhpcyk7XG4gICAgICB0aGlzLnVwZGF0ZShpdGVtKTtcbiAgICB9XG5cbiAgICBJdGVtLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgICB2YXIga2V5LCB2YWx1ZTtcbiAgICAgIGZvciAoa2V5IGluIGl0ZW0pIHtcbiAgICAgICAgdmFsdWUgPSBpdGVtW2tleV07XG4gICAgICAgIGlmIChrZXkgIT09ICdwcm9wZXJ0aWVzJykge1xuICAgICAgICAgIHRoaXNba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzID0gQ2FydEpTLlV0aWxzLmV4dGVuZCh7fSwgaXRlbS5wcm9wZXJ0aWVzKTtcbiAgICB9O1xuXG4gICAgSXRlbS5wcm90b3R5cGUucHJvcGVydHlBcnJheSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG5hbWUsIHZhbHVlLCBfcmVmLCBfcmVzdWx0cztcbiAgICAgIF9yZWYgPSB0aGlzLnByb3BlcnRpZXM7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChuYW1lIGluIF9yZWYpIHtcbiAgICAgICAgdmFsdWUgPSBfcmVmW25hbWVdO1xuICAgICAgICBfcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9O1xuXG4gICAgcmV0dXJuIEl0ZW07XG5cbiAgfSkoKTtcblxuICBDYXJ0SlMgPSB7XG4gICAgc2V0dGluZ3M6IHtcbiAgICAgIGRhdGFBUEk6IHRydWUsXG4gICAgICByZXF1ZXN0Qm9keUNsYXNzOiBudWxsLFxuICAgICAgcml2ZXRzTW9kZWxzOiB7fSxcbiAgICAgIG1vbmV5Rm9ybWF0OiBudWxsLFxuICAgICAgbW9uZXlXaXRoQ3VycmVuY3lGb3JtYXQ6IG51bGxcbiAgICB9LFxuICAgIGNhcnQ6IG5ldyBDYXJ0KClcbiAgfTtcblxuICBDYXJ0SlMuaW5pdCA9IGZ1bmN0aW9uKGNhcnQsIHNldHRpbmdzKSB7XG4gICAgaWYgKHNldHRpbmdzID09IG51bGwpIHtcbiAgICAgIHNldHRpbmdzID0ge307XG4gICAgfVxuICAgIENhcnRKUy5jb25maWd1cmUoc2V0dGluZ3MpO1xuICAgIENhcnRKUy5jYXJ0LnVwZGF0ZShjYXJ0KTtcbiAgICBpZiAoQ2FydEpTLnNldHRpbmdzLmRhdGFBUEkpIHtcbiAgICAgIENhcnRKUy5EYXRhLmluaXQoKTtcbiAgICB9XG4gICAgaWYgKENhcnRKUy5zZXR0aW5ncy5yZXF1ZXN0Qm9keUNsYXNzKSB7XG4gICAgICAkKGRvY3VtZW50KS5vbignY2FydC5yZXF1ZXN0U3RhcnRlZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJCgnYm9keScpLmFkZENsYXNzKENhcnRKUy5zZXR0aW5ncy5yZXF1ZXN0Qm9keUNsYXNzKTtcbiAgICAgIH0pO1xuICAgICAgJChkb2N1bWVudCkub24oJ2NhcnQucmVxdWVzdENvbXBsZXRlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAkKCdib2R5JykucmVtb3ZlQ2xhc3MoQ2FydEpTLnNldHRpbmdzLnJlcXVlc3RCb2R5Q2xhc3MpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBDYXJ0SlMuUml2ZXRzLmluaXQoKTtcbiAgfTtcblxuICBDYXJ0SlMuY29uZmlndXJlID0gZnVuY3Rpb24oc2V0dGluZ3MpIHtcbiAgICBpZiAoc2V0dGluZ3MgPT0gbnVsbCkge1xuICAgICAgc2V0dGluZ3MgPSB7fTtcbiAgICB9XG4gICAgcmV0dXJuIENhcnRKUy5VdGlscy5leHRlbmQoQ2FydEpTLnNldHRpbmdzLCBzZXR0aW5ncyk7XG4gIH07XG5cbiAgQ2FydEpTLlV0aWxzID0ge1xuICAgIHdyYXBLZXlzOiBmdW5jdGlvbihvYmosIHR5cGUsIG92ZXJyaWRlKSB7XG4gICAgICB2YXIga2V5LCB2YWx1ZSwgd3JhcHBlZDtcbiAgICAgIGlmICh0eXBlID09IG51bGwpIHtcbiAgICAgICAgdHlwZSA9ICdwcm9wZXJ0aWVzJztcbiAgICAgIH1cbiAgICAgIHdyYXBwZWQgPSB7fTtcbiAgICAgIGZvciAoa2V5IGluIG9iaikge1xuICAgICAgICB2YWx1ZSA9IG9ialtrZXldO1xuICAgICAgICB3cmFwcGVkW1wiXCIgKyB0eXBlICsgXCJbXCIgKyBrZXkgKyBcIl1cIl0gPSBvdmVycmlkZSAhPSBudWxsID8gb3ZlcnJpZGUgOiB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB3cmFwcGVkO1xuICAgIH0sXG4gICAgdW53cmFwS2V5czogZnVuY3Rpb24ob2JqLCB0eXBlLCBvdmVycmlkZSkge1xuICAgICAgdmFyIGtleSwgdW53cmFwcGVkLCB1bndyYXBwZWRLZXksIHZhbHVlO1xuICAgICAgaWYgKHR5cGUgPT0gbnVsbCkge1xuICAgICAgICB0eXBlID0gJ3Byb3BlcnRpZXMnO1xuICAgICAgfVxuICAgICAgdW53cmFwcGVkID0ge307XG4gICAgICBmb3IgKGtleSBpbiBvYmopIHtcbiAgICAgICAgdmFsdWUgPSBvYmpba2V5XTtcbiAgICAgICAgdW53cmFwcGVkS2V5ID0ga2V5LnJlcGxhY2UoXCJcIiArIHR5cGUgKyBcIltcIiwgXCJcIikucmVwbGFjZShcIl1cIiwgXCJcIik7XG4gICAgICAgIHVud3JhcHBlZFt1bndyYXBwZWRLZXldID0gb3ZlcnJpZGUgIT0gbnVsbCA/IG92ZXJyaWRlIDogdmFsdWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gdW53cmFwcGVkO1xuICAgIH0sXG4gICAgZXh0ZW5kOiBmdW5jdGlvbihvYmplY3QsIHByb3BlcnRpZXMpIHtcbiAgICAgIHZhciBrZXksIHZhbDtcbiAgICAgIGZvciAoa2V5IGluIHByb3BlcnRpZXMpIHtcbiAgICAgICAgdmFsID0gcHJvcGVydGllc1trZXldO1xuICAgICAgICBvYmplY3Rba2V5XSA9IHZhbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfSxcbiAgICBjbG9uZTogZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgICB2YXIga2V5LCBuZXdJbnN0YW5jZTtcbiAgICAgIGlmICgob2JqZWN0ID09IG51bGwpIHx8IHR5cGVvZiBvYmplY3QgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgICB9XG4gICAgICBuZXdJbnN0YW5jZSA9IG5ldyBvYmplY3QuY29uc3RydWN0b3IoKTtcbiAgICAgIGZvciAoa2V5IGluIG9iamVjdCkge1xuICAgICAgICBuZXdJbnN0YW5jZVtrZXldID0gY2xvbmUob2JqZWN0W2tleV0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ld0luc3RhbmNlO1xuICAgIH0sXG4gICAgaXNBcnJheTogQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgcmV0dXJuIHt9LnRvU3RyaW5nLmNhbGwodmFsdWUpID09PSAnW29iamVjdCBBcnJheV0nO1xuICAgIH0sXG4gICAgZW5zdXJlQXJyYXk6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoQ2FydEpTLlV0aWxzLmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7XG4gICAgICAgIHJldHVybiBbdmFsdWVdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgIH0sXG4gICAgZm9ybWF0TW9uZXk6IGZ1bmN0aW9uKHZhbHVlLCBmb3JtYXQpIHtcbiAgICAgIHZhciBfcmVmO1xuICAgICAgaWYgKCgoX3JlZiA9IHdpbmRvdy5TaG9waWZ5KSAhPSBudWxsID8gX3JlZi5mb3JtYXRNb25leSA6IHZvaWQgMCkgIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gU2hvcGlmeS5mb3JtYXRNb25leSh2YWx1ZSwgZm9ybWF0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGdldFNpemVkSW1hZ2VVcmw6IGZ1bmN0aW9uKHNyYywgc2l6ZSkge1xuICAgICAgdmFyIF9yZWYsIF9yZWYxO1xuICAgICAgaWYgKCgoX3JlZiA9IHdpbmRvdy5TaG9waWZ5KSAhPSBudWxsID8gKF9yZWYxID0gX3JlZi5JbWFnZSkgIT0gbnVsbCA/IF9yZWYxLmdldFNpemVkSW1hZ2VVcmwgOiB2b2lkIDAgOiB2b2lkIDApICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIFNob3BpZnkuSW1hZ2UuZ2V0U2l6ZWRJbWFnZVVybChzcmMsIHNpemUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHNyYztcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcXVldWUgPSBbXTtcblxuICBwcm9jZXNzaW5nID0gZmFsc2U7XG5cbiAgQ2FydEpTLlF1ZXVlID0ge1xuICAgIGFkZDogZnVuY3Rpb24odXJsLCBkYXRhLCBvcHRpb25zKSB7XG4gICAgICB2YXIgcmVxdWVzdDtcbiAgICAgIGlmIChvcHRpb25zID09IG51bGwpIHtcbiAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgfVxuICAgICAgcmVxdWVzdCA9IHtcbiAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgIHR5cGU6IG9wdGlvbnMudHlwZSB8fCAnUE9TVCcsXG4gICAgICAgIGRhdGFUeXBlOiBvcHRpb25zLmRhdGFUeXBlIHx8ICdqc29uJyxcbiAgICAgICAgc3VjY2VzczogQ2FydEpTLlV0aWxzLmVuc3VyZUFycmF5KG9wdGlvbnMuc3VjY2VzcyksXG4gICAgICAgIGVycm9yOiBDYXJ0SlMuVXRpbHMuZW5zdXJlQXJyYXkob3B0aW9ucy5lcnJvciksXG4gICAgICAgIGNvbXBsZXRlOiBDYXJ0SlMuVXRpbHMuZW5zdXJlQXJyYXkob3B0aW9ucy5jb21wbGV0ZSlcbiAgICAgIH07XG4gICAgICBpZiAob3B0aW9ucy51cGRhdGVDYXJ0KSB7XG4gICAgICAgIHJlcXVlc3Quc3VjY2Vzcy5wdXNoKENhcnRKUy5jYXJ0LnVwZGF0ZSk7XG4gICAgICB9XG4gICAgICBxdWV1ZS5wdXNoKHJlcXVlc3QpO1xuICAgICAgaWYgKHByb2Nlc3NpbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgalF1ZXJ5KGRvY3VtZW50KS50cmlnZ2VyKCdjYXJ0LnJlcXVlc3RTdGFydGVkJywgW0NhcnRKUy5jYXJ0XSk7XG4gICAgICByZXR1cm4gQ2FydEpTLlF1ZXVlLnByb2Nlc3MoKTtcbiAgICB9LFxuICAgIHByb2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHBhcmFtcztcbiAgICAgIGlmICghcXVldWUubGVuZ3RoKSB7XG4gICAgICAgIHByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS50cmlnZ2VyKCdjYXJ0LnJlcXVlc3RDb21wbGV0ZScsIFtDYXJ0SlMuY2FydF0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBwcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICAgIHBhcmFtcyA9IHF1ZXVlLnNoaWZ0KCk7XG4gICAgICBwYXJhbXMuY29tcGxldGUgPSBDYXJ0SlMuUXVldWUucHJvY2VzcztcbiAgICAgIHJldHVybiBqUXVlcnkuYWpheChwYXJhbXMpO1xuICAgIH1cbiAgfTtcblxuICBDYXJ0SlMuQ29yZSA9IHtcbiAgICBnZXRDYXJ0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgIH1cbiAgICAgIG9wdGlvbnMudHlwZSA9ICdHRVQnO1xuICAgICAgb3B0aW9ucy51cGRhdGVDYXJ0ID0gdHJ1ZTtcbiAgICAgIHJldHVybiBDYXJ0SlMuUXVldWUuYWRkKCcvY2FydC5qcycsIHt9LCBvcHRpb25zKTtcbiAgICB9LFxuICAgIGFkZEl0ZW06IGZ1bmN0aW9uKGlkLCBxdWFudGl0eSwgcHJvcGVydGllcywgb3B0aW9ucykge1xuICAgICAgdmFyIGRhdGE7XG4gICAgICBpZiAocXVhbnRpdHkgPT0gbnVsbCkge1xuICAgICAgICBxdWFudGl0eSA9IDE7XG4gICAgICB9XG4gICAgICBpZiAocHJvcGVydGllcyA9PSBudWxsKSB7XG4gICAgICAgIHByb3BlcnRpZXMgPSB7fTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zID09IG51bGwpIHtcbiAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgfVxuICAgICAgZGF0YSA9IENhcnRKUy5VdGlscy53cmFwS2V5cyhwcm9wZXJ0aWVzKTtcbiAgICAgIGRhdGEuaWQgPSBpZDtcbiAgICAgIGRhdGEucXVhbnRpdHkgPSBxdWFudGl0eTtcbiAgICAgIENhcnRKUy5RdWV1ZS5hZGQoJy9jYXJ0L2FkZC5qcycsIGRhdGEsIG9wdGlvbnMpO1xuICAgICAgcmV0dXJuIENhcnRKUy5Db3JlLmdldENhcnQoKTtcbiAgICB9LFxuICAgIHVwZGF0ZUl0ZW06IGZ1bmN0aW9uKGxpbmUsIHF1YW50aXR5LCBwcm9wZXJ0aWVzLCBvcHRpb25zKSB7XG4gICAgICB2YXIgZGF0YTtcbiAgICAgIGlmIChwcm9wZXJ0aWVzID09IG51bGwpIHtcbiAgICAgICAgcHJvcGVydGllcyA9IHt9O1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgICBvcHRpb25zID0ge307XG4gICAgICB9XG4gICAgICBkYXRhID0gQ2FydEpTLlV0aWxzLndyYXBLZXlzKHByb3BlcnRpZXMpO1xuICAgICAgZGF0YS5saW5lID0gbGluZTtcbiAgICAgIGlmIChxdWFudGl0eSAhPSBudWxsKSB7XG4gICAgICAgIGRhdGEucXVhbnRpdHkgPSBxdWFudGl0eTtcbiAgICAgIH1cbiAgICAgIG9wdGlvbnMudXBkYXRlQ2FydCA9IHRydWU7XG4gICAgICByZXR1cm4gQ2FydEpTLlF1ZXVlLmFkZCgnL2NhcnQvY2hhbmdlLmpzJywgZGF0YSwgb3B0aW9ucyk7XG4gICAgfSxcbiAgICByZW1vdmVJdGVtOiBmdW5jdGlvbihsaW5lLCBvcHRpb25zKSB7XG4gICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBDYXJ0SlMuQ29yZS51cGRhdGVJdGVtKGxpbmUsIDAsIHt9LCBvcHRpb25zKTtcbiAgICB9LFxuICAgIHVwZGF0ZUl0ZW1CeUlkOiBmdW5jdGlvbihpZCwgcXVhbnRpdHksIHByb3BlcnRpZXMsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBkYXRhO1xuICAgICAgaWYgKHByb3BlcnRpZXMgPT0gbnVsbCkge1xuICAgICAgICBwcm9wZXJ0aWVzID0ge307XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgIH1cbiAgICAgIGRhdGEgPSBDYXJ0SlMuVXRpbHMud3JhcEtleXMocHJvcGVydGllcyk7XG4gICAgICBkYXRhLmlkID0gaWQ7XG4gICAgICBpZiAocXVhbnRpdHkgIT0gbnVsbCkge1xuICAgICAgICBkYXRhLnF1YW50aXR5ID0gcXVhbnRpdHk7XG4gICAgICB9XG4gICAgICBvcHRpb25zLnVwZGF0ZUNhcnQgPSB0cnVlO1xuICAgICAgcmV0dXJuIENhcnRKUy5RdWV1ZS5hZGQoJy9jYXJ0L2NoYW5nZS5qcycsIGRhdGEsIG9wdGlvbnMpO1xuICAgIH0sXG4gICAgdXBkYXRlSXRlbVF1YW50aXRpZXNCeUlkOiBmdW5jdGlvbih1cGRhdGVzLCBvcHRpb25zKSB7XG4gICAgICBpZiAodXBkYXRlcyA9PSBudWxsKSB7XG4gICAgICAgIHVwZGF0ZXMgPSB7fTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zID09IG51bGwpIHtcbiAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgfVxuICAgICAgb3B0aW9ucy51cGRhdGVDYXJ0ID0gdHJ1ZTtcbiAgICAgIHJldHVybiBDYXJ0SlMuUXVldWUuYWRkKCcvY2FydC91cGRhdGUuanMnLCB7XG4gICAgICAgIHVwZGF0ZXM6IHVwZGF0ZXNcbiAgICAgIH0sIG9wdGlvbnMpO1xuICAgIH0sXG4gICAgcmVtb3ZlSXRlbUJ5SWQ6IGZ1bmN0aW9uKGlkLCBvcHRpb25zKSB7XG4gICAgICB2YXIgZGF0YTtcbiAgICAgIGlmIChvcHRpb25zID09IG51bGwpIHtcbiAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgfVxuICAgICAgZGF0YSA9IHtcbiAgICAgICAgaWQ6IGlkLFxuICAgICAgICBxdWFudGl0eTogMFxuICAgICAgfTtcbiAgICAgIG9wdGlvbnMudXBkYXRlQ2FydCA9IHRydWU7XG4gICAgICByZXR1cm4gQ2FydEpTLlF1ZXVlLmFkZCgnL2NhcnQvY2hhbmdlLmpzJywgZGF0YSwgb3B0aW9ucyk7XG4gICAgfSxcbiAgICBjbGVhcjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgICBvcHRpb25zID0ge307XG4gICAgICB9XG4gICAgICBvcHRpb25zLnVwZGF0ZUNhcnQgPSB0cnVlO1xuICAgICAgcmV0dXJuIENhcnRKUy5RdWV1ZS5hZGQoJy9jYXJ0L2NsZWFyLmpzJywge30sIG9wdGlvbnMpO1xuICAgIH0sXG4gICAgZ2V0QXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgIGlmIChhdHRyaWJ1dGVOYW1lIGluIENhcnRKUy5jYXJ0LmF0dHJpYnV0ZXMpIHtcbiAgICAgICAgcmV0dXJuIENhcnRKUy5jYXJ0LmF0dHJpYnV0ZXNbYXR0cmlidXRlTmFtZV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgICAgfVxuICAgIH0sXG4gICAgc2V0QXR0cmlidXRlOiBmdW5jdGlvbihhdHRyaWJ1dGVOYW1lLCB2YWx1ZSwgb3B0aW9ucykge1xuICAgICAgdmFyIGF0dHJpYnV0ZXM7XG4gICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgIH1cbiAgICAgIGF0dHJpYnV0ZXMgPSB7fTtcbiAgICAgIGF0dHJpYnV0ZXNbYXR0cmlidXRlTmFtZV0gPSB2YWx1ZTtcbiAgICAgIHJldHVybiBDYXJ0SlMuQ29yZS5zZXRBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMsIG9wdGlvbnMpO1xuICAgIH0sXG4gICAgZ2V0QXR0cmlidXRlczogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gQ2FydEpTLmNhcnQuYXR0cmlidXRlcztcbiAgICB9LFxuICAgIHNldEF0dHJpYnV0ZXM6IGZ1bmN0aW9uKGF0dHJpYnV0ZXMsIG9wdGlvbnMpIHtcbiAgICAgIGlmIChhdHRyaWJ1dGVzID09IG51bGwpIHtcbiAgICAgICAgYXR0cmlidXRlcyA9IHt9O1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgICBvcHRpb25zID0ge307XG4gICAgICB9XG4gICAgICBvcHRpb25zLnVwZGF0ZUNhcnQgPSB0cnVlO1xuICAgICAgcmV0dXJuIENhcnRKUy5RdWV1ZS5hZGQoJy9jYXJ0L3VwZGF0ZS5qcycsIENhcnRKUy5VdGlscy53cmFwS2V5cyhhdHRyaWJ1dGVzLCAnYXR0cmlidXRlcycpLCBvcHRpb25zKTtcbiAgICB9LFxuICAgIGNsZWFyQXR0cmlidXRlczogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgICBvcHRpb25zID0ge307XG4gICAgICB9XG4gICAgICBvcHRpb25zLnVwZGF0ZUNhcnQgPSB0cnVlO1xuICAgICAgcmV0dXJuIENhcnRKUy5RdWV1ZS5hZGQoJy9jYXJ0L3VwZGF0ZS5qcycsIENhcnRKUy5VdGlscy53cmFwS2V5cyhDYXJ0SlMuQ29yZS5nZXRBdHRyaWJ1dGVzKCksICdhdHRyaWJ1dGVzJywgJycpLCBvcHRpb25zKTtcbiAgICB9LFxuICAgIGdldE5vdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIENhcnRKUy5jYXJ0Lm5vdGU7XG4gICAgfSxcbiAgICBzZXROb3RlOiBmdW5jdGlvbihub3RlLCBvcHRpb25zKSB7XG4gICAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgIH1cbiAgICAgIG9wdGlvbnMudXBkYXRlQ2FydCA9IHRydWU7XG4gICAgICByZXR1cm4gQ2FydEpTLlF1ZXVlLmFkZCgnL2NhcnQvdXBkYXRlLmpzJywge1xuICAgICAgICBub3RlOiBub3RlXG4gICAgICB9LCBvcHRpb25zKTtcbiAgICB9XG4gIH07XG5cbiAgJGRvY3VtZW50ID0galF1ZXJ5KGRvY3VtZW50KTtcblxuICBDYXJ0SlMuRGF0YSA9IHtcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIENhcnRKUy5EYXRhLnNldEV2ZW50TGlzdGVuZXJzKCdvbicpO1xuICAgICAgcmV0dXJuIENhcnRKUy5EYXRhLnJlbmRlcihudWxsLCBDYXJ0SlMuY2FydCk7XG4gICAgfSxcbiAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBDYXJ0SlMuRGF0YS5zZXRFdmVudExpc3RlbmVycygnb2ZmJyk7XG4gICAgfSxcbiAgICBzZXRFdmVudExpc3RlbmVyczogZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgICAkZG9jdW1lbnRbbWV0aG9kXSgnY2xpY2snLCAnW2RhdGEtY2FydC1hZGRdJywgQ2FydEpTLkRhdGEuYWRkKTtcbiAgICAgICRkb2N1bWVudFttZXRob2RdKCdjbGljaycsICdbZGF0YS1jYXJ0LXJlbW92ZV0nLCBDYXJ0SlMuRGF0YS5yZW1vdmUpO1xuICAgICAgJGRvY3VtZW50W21ldGhvZF0oJ2NsaWNrJywgJ1tkYXRhLWNhcnQtcmVtb3ZlLWlkXScsIENhcnRKUy5EYXRhLnJlbW92ZUJ5SWQpO1xuICAgICAgJGRvY3VtZW50W21ldGhvZF0oJ2NsaWNrJywgJ1tkYXRhLWNhcnQtdXBkYXRlXScsIENhcnRKUy5EYXRhLnVwZGF0ZSk7XG4gICAgICAkZG9jdW1lbnRbbWV0aG9kXSgnY2xpY2snLCAnW2RhdGEtY2FydC11cGRhdGUtaWRdJywgQ2FydEpTLkRhdGEudXBkYXRlQnlJZCk7XG4gICAgICAkZG9jdW1lbnRbbWV0aG9kXSgnY2xpY2snLCAnW2RhdGEtY2FydC1jbGVhcl0nLCBDYXJ0SlMuRGF0YS5jbGVhcik7XG4gICAgICAkZG9jdW1lbnRbbWV0aG9kXSgnY2hhbmdlJywgJ1tkYXRhLWNhcnQtdG9nZ2xlXScsIENhcnRKUy5EYXRhLnRvZ2dsZSk7XG4gICAgICAkZG9jdW1lbnRbbWV0aG9kXSgnY2hhbmdlJywgJ1tkYXRhLWNhcnQtdG9nZ2xlLWF0dHJpYnV0ZV0nLCBDYXJ0SlMuRGF0YS50b2dnbGVBdHRyaWJ1dGUpO1xuICAgICAgJGRvY3VtZW50W21ldGhvZF0oJ3N1Ym1pdCcsICdbZGF0YS1jYXJ0LXN1Ym1pdF0nLCBDYXJ0SlMuRGF0YS5zdWJtaXQpO1xuICAgICAgcmV0dXJuICRkb2N1bWVudFttZXRob2RdKCdjYXJ0LnJlcXVlc3RDb21wbGV0ZScsIENhcnRKUy5EYXRhLnJlbmRlcik7XG4gICAgfSxcbiAgICBhZGQ6IGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciAkdGhpcztcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICR0aGlzID0galF1ZXJ5KHRoaXMpO1xuICAgICAgcmV0dXJuIENhcnRKUy5Db3JlLmFkZEl0ZW0oJHRoaXMuYXR0cignZGF0YS1jYXJ0LWFkZCcpLCAkdGhpcy5hdHRyKCdkYXRhLWNhcnQtcXVhbnRpdHknKSk7XG4gICAgfSxcbiAgICByZW1vdmU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciAkdGhpcztcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICR0aGlzID0galF1ZXJ5KHRoaXMpO1xuICAgICAgcmV0dXJuIENhcnRKUy5Db3JlLnJlbW92ZUl0ZW0oJHRoaXMuYXR0cignZGF0YS1jYXJ0LXJlbW92ZScpKTtcbiAgICB9LFxuICAgIHJlbW92ZUJ5SWQ6IGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciAkdGhpcztcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICR0aGlzID0galF1ZXJ5KHRoaXMpO1xuICAgICAgcmV0dXJuIENhcnRKUy5Db3JlLnJlbW92ZUl0ZW1CeUlkKCR0aGlzLmF0dHIoJ2RhdGEtY2FydC1yZW1vdmUtaWQnKSk7XG4gICAgfSxcbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciAkdGhpcztcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICR0aGlzID0galF1ZXJ5KHRoaXMpO1xuICAgICAgcmV0dXJuIENhcnRKUy5Db3JlLnVwZGF0ZUl0ZW0oJHRoaXMuYXR0cignZGF0YS1jYXJ0LXVwZGF0ZScpLCAkdGhpcy5hdHRyKCdkYXRhLWNhcnQtcXVhbnRpdHknKSk7XG4gICAgfSxcbiAgICB1cGRhdGVCeUlkOiBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgJHRoaXM7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAkdGhpcyA9IGpRdWVyeSh0aGlzKTtcbiAgICAgIHJldHVybiBDYXJ0SlMuQ29yZS51cGRhdGVJdGVtQnlJZCgkdGhpcy5hdHRyKCdkYXRhLWNhcnQtdXBkYXRlLWlkJyksICR0aGlzLmF0dHIoJ2RhdGEtY2FydC1xdWFudGl0eScpKTtcbiAgICB9LFxuICAgIGNsZWFyOiBmdW5jdGlvbihlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm4gQ2FydEpTLkNvcmUuY2xlYXIoKTtcbiAgICB9LFxuICAgIHRvZ2dsZTogZnVuY3Rpb24oZSkge1xuICAgICAgdmFyICRpbnB1dCwgaWQ7XG4gICAgICAkaW5wdXQgPSBqUXVlcnkodGhpcyk7XG4gICAgICBpZCA9ICRpbnB1dC5hdHRyKCdkYXRhLWNhcnQtdG9nZ2xlJyk7XG4gICAgICBpZiAoJGlucHV0LmlzKCc6Y2hlY2tlZCcpKSB7XG4gICAgICAgIHJldHVybiBDYXJ0SlMuQ29yZS5hZGRJdGVtKGlkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBDYXJ0SlMuQ29yZS5yZW1vdmVBbGwoaWQpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdG9nZ2xlQXR0cmlidXRlOiBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgJGlucHV0LCBhdHRyaWJ1dGU7XG4gICAgICAkaW5wdXQgPSBqUXVlcnkodGhpcyk7XG4gICAgICBhdHRyaWJ1dGUgPSAkaW5wdXQuYXR0cignZGF0YS1jYXJ0LXRvZ2dsZS1hdHRyaWJ1dGUnKTtcbiAgICAgIHJldHVybiBDYXJ0SlMuQ29yZS5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlLCAkaW5wdXQuaXMoJzpjaGVja2VkJykgPyAnWWVzJyA6ICcnKTtcbiAgICB9LFxuICAgIHN1Ym1pdDogZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIGRhdGFBcnJheSwgaWQsIHByb3BlcnRpZXMsIHF1YW50aXR5O1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZGF0YUFycmF5ID0galF1ZXJ5KHRoaXMpLnNlcmlhbGl6ZUFycmF5KCk7XG4gICAgICBpZCA9IHZvaWQgMDtcbiAgICAgIHF1YW50aXR5ID0gdm9pZCAwO1xuICAgICAgcHJvcGVydGllcyA9IHt9O1xuICAgICAgalF1ZXJ5LmVhY2goZGF0YUFycmF5LCBmdW5jdGlvbihpLCBpdGVtKSB7XG4gICAgICAgIGlmIChpdGVtLm5hbWUgPT09ICdpZCcpIHtcbiAgICAgICAgICByZXR1cm4gaWQgPSBpdGVtLnZhbHVlO1xuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0ubmFtZSA9PT0gJ3F1YW50aXR5Jykge1xuICAgICAgICAgIHJldHVybiBxdWFudGl0eSA9IGl0ZW0udmFsdWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHByb3BlcnRpZXNbaXRlbS5uYW1lXSA9IGl0ZW0udmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIENhcnRKUy5Db3JlLmFkZEl0ZW0oaWQsIHF1YW50aXR5LCBDYXJ0SlMuVXRpbHMudW53cmFwS2V5cyhwcm9wZXJ0aWVzKSk7XG4gICAgfSxcbiAgICByZW5kZXI6IGZ1bmN0aW9uKGUsIGNhcnQpIHtcbiAgICAgIHZhciBjb250ZXh0O1xuICAgICAgY29udGV4dCA9IHtcbiAgICAgICAgJ2l0ZW1fY291bnQnOiBjYXJ0Lml0ZW1fY291bnQsXG4gICAgICAgICd0b3RhbF9wcmljZSc6IGNhcnQudG90YWxfcHJpY2UsXG4gICAgICAgICd0b3RhbF9wcmljZV9tb25leSc6IENhcnRKUy5VdGlscy5mb3JtYXRNb25leShjYXJ0LnRvdGFsX3ByaWNlLCBDYXJ0SlMuc2V0dGluZ3MubW9uZXlGb3JtYXQpLFxuICAgICAgICAndG90YWxfcHJpY2VfbW9uZXlfd2l0aF9jdXJyZW5jeSc6IENhcnRKUy5VdGlscy5mb3JtYXRNb25leShjYXJ0LnRvdGFsX3ByaWNlLCBDYXJ0SlMuc2V0dGluZ3MubW9uZXlXaXRoQ3VycmVuY3lGb3JtYXQpXG4gICAgICB9O1xuICAgICAgcmV0dXJuIGpRdWVyeSgnW2RhdGEtY2FydC1yZW5kZXJdJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyICR0aGlzO1xuICAgICAgICAkdGhpcyA9IGpRdWVyeSh0aGlzKTtcbiAgICAgICAgcmV0dXJuICR0aGlzLnRleHQoY29udGV4dFskdGhpcy5hdHRyKCdkYXRhLWNhcnQtcmVuZGVyJyldKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBpZiAoJ3JpdmV0cycgaW4gd2luZG93KSB7XG4gICAgQ2FydEpTLlJpdmV0cyA9IHtcbiAgICAgIHZpZXdzOiBbXSxcbiAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gQ2FydEpTLlJpdmV0cy5iaW5kVmlld3MoKTtcbiAgICAgIH0sXG4gICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIENhcnRKUy5SaXZldHMudW5iaW5kVmlld3MoKTtcbiAgICAgIH0sXG4gICAgICBiaW5kVmlld3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbW9kZWxzO1xuICAgICAgICBDYXJ0SlMuUml2ZXRzLnVuYmluZFZpZXdzKCk7XG4gICAgICAgIG1vZGVscyA9IENhcnRKUy5VdGlscy5leHRlbmQoe1xuICAgICAgICAgIGNhcnQ6IENhcnRKUy5jYXJ0XG4gICAgICAgIH0sIENhcnRKUy5zZXR0aW5ncy5yaXZldHNNb2RlbHMpO1xuICAgICAgICByZXR1cm4galF1ZXJ5KCdbZGF0YS1jYXJ0LXZpZXddJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gQ2FydEpTLlJpdmV0cy52aWV3cy5wdXNoKHJpdmV0cy5iaW5kKHRoaXMsIG1vZGVscykpO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICB1bmJpbmRWaWV3czogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB2aWV3LCBfaSwgX2xlbiwgX3JlZjtcbiAgICAgICAgX3JlZiA9IENhcnRKUy5SaXZldHMudmlld3M7XG4gICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgIHZpZXcgPSBfcmVmW19pXTtcbiAgICAgICAgICB2aWV3LnVuYmluZCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDYXJ0SlMuUml2ZXRzLnZpZXdzID0gW107XG4gICAgICB9XG4gICAgfTtcbiAgICByaXZldHMuZm9ybWF0dGVycy5lcSA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgIHJldHVybiBhID09PSBiO1xuICAgIH07XG4gICAgcml2ZXRzLmZvcm1hdHRlcnMubHQgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICByZXR1cm4gYSA8IGI7XG4gICAgfTtcbiAgICByaXZldHMuZm9ybWF0dGVycy5ndCA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgIHJldHVybiBhID4gYjtcbiAgICB9O1xuICAgIHJpdmV0cy5mb3JtYXR0ZXJzLm5vdCA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgIHJldHVybiAhYTtcbiAgICB9O1xuICAgIHJpdmV0cy5mb3JtYXR0ZXJzLmVtcHR5ID0gZnVuY3Rpb24oYSkge1xuICAgICAgcmV0dXJuICFhLmxlbmd0aDtcbiAgICB9O1xuICAgIHJpdmV0cy5mb3JtYXR0ZXJzLnBsdXMgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICByZXR1cm4gcGFyc2VJbnQoYSkgKyBwYXJzZUludChiKTtcbiAgICB9O1xuICAgIHJpdmV0cy5mb3JtYXR0ZXJzLm1pbnVzID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgcmV0dXJuIHBhcnNlSW50KGEpIC0gcGFyc2VJbnQoYik7XG4gICAgfTtcbiAgICByaXZldHMuZm9ybWF0dGVycy5tb25leSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4gQ2FydEpTLlV0aWxzLmZvcm1hdE1vbmV5KHZhbHVlLCBDYXJ0SlMuc2V0dGluZ3MubW9uZXlGb3JtYXQpO1xuICAgIH07XG4gICAgcml2ZXRzLmZvcm1hdHRlcnMubW9uZXlfd2l0aF9jdXJyZW5jeSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4gQ2FydEpTLlV0aWxzLmZvcm1hdE1vbmV5KHZhbHVlLCBDYXJ0SlMuc2V0dGluZ3MubW9uZXlXaXRoQ3VycmVuY3lGb3JtYXQpO1xuICAgIH07XG4gICAgcml2ZXRzLmZvcm1hdHRlcnMucHJvZHVjdEltYWdlU2l6ZSA9IGZ1bmN0aW9uKHNyYywgc2l6ZSkge1xuICAgICAgcmV0dXJuIENhcnRKUy5VdGlscy5nZXRTaXplZEltYWdlVXJsKHNyYywgc2l6ZSk7XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICBDYXJ0SlMuUml2ZXRzID0ge1xuICAgICAgaW5pdDogZnVuY3Rpb24oKSB7fSxcbiAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge31cbiAgICB9O1xuICB9XG5cbiAgQ2FydEpTLmZhY3RvcnkgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gICAgZXhwb3J0cy5pbml0ID0gQ2FydEpTLmluaXQ7XG4gICAgZXhwb3J0cy5jb25maWd1cmUgPSBDYXJ0SlMuY29uZmlndXJlO1xuICAgIGV4cG9ydHMuY2FydCA9IENhcnRKUy5jYXJ0O1xuICAgIGV4cG9ydHMuc2V0dGluZ3MgPSBDYXJ0SlMuc2V0dGluZ3M7XG4gICAgZXhwb3J0cy5hZGRJdGVtID0gQ2FydEpTLkNvcmUuYWRkSXRlbTtcbiAgICBleHBvcnRzLnVwZGF0ZUl0ZW0gPSBDYXJ0SlMuQ29yZS51cGRhdGVJdGVtO1xuICAgIGV4cG9ydHMudXBkYXRlSXRlbUJ5SWQgPSBDYXJ0SlMuQ29yZS51cGRhdGVJdGVtQnlJZDtcbiAgICBleHBvcnRzLnVwZGF0ZUl0ZW1RdWFudGl0aWVzQnlJZCA9IENhcnRKUy5Db3JlLnVwZGF0ZUl0ZW1RdWFudGl0aWVzQnlJZDtcbiAgICBleHBvcnRzLnJlbW92ZUl0ZW0gPSBDYXJ0SlMuQ29yZS5yZW1vdmVJdGVtO1xuICAgIGV4cG9ydHMucmVtb3ZlQWxsID0gQ2FydEpTLkNvcmUucmVtb3ZlQWxsO1xuICAgIGV4cG9ydHMuY2xlYXIgPSBDYXJ0SlMuQ29yZS5jbGVhcjtcbiAgICBleHBvcnRzLmdldEF0dHJpYnV0ZSA9IENhcnRKUy5Db3JlLmdldEF0dHJpYnV0ZTtcbiAgICBleHBvcnRzLnNldEF0dHJpYnV0ZSA9IENhcnRKUy5Db3JlLnNldEF0dHJpYnV0ZTtcbiAgICBleHBvcnRzLmdldEF0dHJpYnV0ZXMgPSBDYXJ0SlMuQ29yZS5nZXRBdHRyaWJ1dGVzO1xuICAgIGV4cG9ydHMuc2V0QXR0cmlidXRlcyA9IENhcnRKUy5Db3JlLnNldEF0dHJpYnV0ZXM7XG4gICAgZXhwb3J0cy5jbGVhckF0dHJpYnV0ZXMgPSBDYXJ0SlMuQ29yZS5jbGVhckF0dHJpYnV0ZXM7XG4gICAgZXhwb3J0cy5nZXROb3RlID0gQ2FydEpTLkNvcmUuZ2V0Tm90ZTtcbiAgICByZXR1cm4gZXhwb3J0cy5zZXROb3RlID0gQ2FydEpTLkNvcmUuc2V0Tm90ZTtcbiAgfTtcblxuICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgQ2FydEpTLmZhY3RvcnkoZXhwb3J0cyk7XG4gIH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFsnZXhwb3J0cyddLCBmdW5jdGlvbihleHBvcnRzKSB7XG4gICAgICBDYXJ0SlMuZmFjdG9yeSh0aGlzLkNhcnRKUyA9IGV4cG9ydHMpO1xuICAgICAgcmV0dXJuIGV4cG9ydHM7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgQ2FydEpTLmZhY3RvcnkodGhpcy5DYXJ0SlMgPSB7fSk7XG4gIH1cblxufSkuY2FsbCh0aGlzKTtcbiIsInZhciBDYXJ0ID0ge307XG5cbnZhciBtZXNzYWdlX2NvdW50ID0gMDtcblxuLy8gQ2FydCB2YXJzXG52YXIgJGNhcnRfZGlzcGxheV9lbGUgPSAkKCdbZGF0YS1jYXJ0LWRpc3BsYXldJyk7XG52YXIgJGNhcnRfdGFibGVfZWxlID0gJChCc2lmeS5zZWxlY3RvcnMuY2FydC50YWJsZV9zZWxlY3Rvcik7XG52YXIgJGNhcnRfbWVzc2FnZV9lbGUgPSAkKEJzaWZ5LnNlbGVjdG9ycy5jYXJ0Lm1lc3NhZ2Vfc2VsZWN0b3IpO1xuXG4vLyBwcm9kdWN0IHZhcnNcbmlmIChCc2lmeS5wcm9kdWN0KSB7XG4gIHZhciAkcHJvZHVjdF9mb3JtX2VsZSA9ICQoQnNpZnkuc2VsZWN0b3JzLnByb2R1Y3QuZm9ybV9zZWxlY3Rvcik7XG4gIHZhciAkcHJvZHVjdF9mb3JtX2J1dHRvbiA9ICRwcm9kdWN0X2Zvcm1fZWxlLmZpbmQoJ2lucHV0W3R5cGU9c3VibWl0XScpO1xuICB2YXIgJHByb2R1Y3RfZm9ybV9tZXNzYWdlX2VsZSA9ICQoQnNpZnkuc2VsZWN0b3JzLnByb2R1Y3QuZm9ybV9tZXNzYWdlX3NlbGVjdG9yKTtcbn1cblxuLy8gU2V0IHVwIGNhcnQgZXZlbnQgaGFuZGxlcnNcbkNhcnQuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgXG4gIC8vIGZpcmVkIHdoZW4gdGhlIENhcnRKUyBvYmplY3QgaGFzIGZpbmlzaGVkIHVwZGF0aW5nIHRoZSBjYXJ0XG4gICQoZG9jdW1lbnQpLm9uKCdjYXJ0LnJlcXVlc3RDb21wbGV0ZScsIGZ1bmN0aW9uKGV2ZW50LCBjYXJ0KSB7XG4gICAgLy8gdXBkYXRlIHRoZSBjYXJ0IG5vdGUgaW4gdGhlIG5hdmJhclxuICAgIENhcnQudXBkYXRlX2NhcnRfZGlzcGxheSgpO1xuICAgIENhcnQudXBkYXRlX2NhcnRfdGFibGUoKTtcbiAgfSk7XG4gIFxuICAvLyBBamF4IGFkZCB0byBjYXJ0IGZyb20gcHJvZHVjdCB0ZW1wbGF0ZVxuICBpZiAoQnNpZnkucHJvZHVjdCkge1xuICAgIC8vIENhcHR1cmUgdGhlIGZvcm0gc3VibWl0XG4gICAgJChkb2N1bWVudCkub24oJ3N1Ym1pdCcsIEJzaWZ5LnNlbGVjdG9ycy5wcm9kdWN0LmZvcm1fc2VsZWN0b3IsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB2YXIgJGN1cnJlbnRfdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgQ2FydC5hZGRfaXRlbV90b19jYXJ0KCRjdXJyZW50X3RhcmdldCk7XG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIHJlbW92ZSBpdGVtIGZyb20gY2FydFxuICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnW2RhdGEtcmVtb3ZlLWl0ZW1dJywgZnVuY3Rpb24gKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdmFyICRjdXJyZW50X3RhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICBDYXJ0LnJlbW92ZV9pdGVtX2Zyb21fY2FydCgkY3VycmVudF90YXJnZXQpO1xuICB9KTtcbn07XG5cbi8qXG4gIENhcnQgbWV0aG9kc1xuKi9cblxuQ2FydC5hZGRfaXRlbV90b19jYXJ0ID0gZnVuY3Rpb24gKCRjdXJyZW50X3RhcmdldCkge1xuICB2YXIgdmFsdWVzID0gQ2FydC5mb3JtX3ZhbHVlcygkY3VycmVudF90YXJnZXQuc2VyaWFsaXplQXJyYXkoKSk7XG4gIHZhciBwcm9wZXJ0aWVzID0ge307IC8vIFRPRE86IGRlYWwgd2l0aCBpdGVtIHByb3BlcnRpZXMgd2hlbiBhZGRpbmcgdG8gY2FydFxuICBcbiAgdmFyIHZhcmlhbnQgPSBCc2lmeS5nZXRfdmFyaWFudF9ieV9pZCh2YWx1ZXMuaWQpO1xuICB2YXIgaXRlbV90aXRsZSA9IEJzaWZ5LnByb2R1Y3QudGl0bGUgKyBCc2lmeS50cmFuc2xhdGlvbnMucHJvZHVjdC5pdGVtX3RpdGxlX3NlcGVyYXRvciArIHZhcmlhbnQudGl0bGU7XG4gIFxuICAvLyB1cGRhdGUgdGhlIHVzZXIgdGhhdCB3ZSBhcmUgd29ya2luZyBvbiBpdFxuICAkcHJvZHVjdF9mb3JtX2J1dHRvbi52YWwoQnNpZnkudHJhbnNsYXRpb25zLnByb2R1Y3QuYWRkaW5nX3RvX2NhcnRfYnV0dG9uX3RleHQpO1xuICBcbiAgLy8gYWRkIHRoZSBpdGVtIHRvIHRoZSBjYXJ0XG4gIENhcnRKUy5hZGRJdGVtKHZhbHVlcy5pZCwgdmFsdWVzLnF1YW50aXR5LCBwcm9wZXJ0aWVzLCB7XG4gICAgXCJzdWNjZXNzXCIgOiBmdW5jdGlvbiAoZGF0YSwgdGV4dF9zdGF0dXMsIGpxWEhSKSB7XG4gICAgICBcbiAgICAgIC8vIGNyZWF0ZSBhbmQgZGlzcGxheSBjb21wbGV0ZWQgbWVzc2FnZVxuICAgICAgdmFyIG1lc3NhZ2UgPSBCc2lmeS50cmFuc2xhdGlvbnMucHJvZHVjdC5hZnRlcl9wcm9kdWN0X2FkZGVkX21lc3NhZ2VfaHRtbC5yZXBsYWNlKCdbaXRlbV90aXRsZV0nLCBpdGVtX3RpdGxlKTtcbiAgICAgIENhcnQuc2hvd19tZXNzYWdlKCRwcm9kdWN0X2Zvcm1fbWVzc2FnZV9lbGUsICdzdWNjZXNzJywgbWVzc2FnZSk7XG4gICAgICBcbiAgICAgIC8vIHVwZGF0ZSBhZGQgdG8gY2FydCBidXR0b24gdGV4dFxuICAgICAgJHByb2R1Y3RfZm9ybV9idXR0b24udmFsKEJzaWZ5LnRyYW5zbGF0aW9ucy5wcm9kdWN0LmFkZGVkX3RvX2NhcnRfYnV0dG9uX3RleHQpO1xuICAgICAgXG4gICAgfSxcbiAgICBcImVycm9yXCI6IGZ1bmN0aW9uKGpxWEhSLCB0ZXh0X3N0YXR1cywgZXJyb3JfdGhyb3duKSB7XG4gICAgICBjb25zb2xlLmxvZygnW0VSUk9SXSAtIEFkZCB0byBjYXJ0OicsIGpxWEhSLCB0ZXh0X3N0YXR1cywgZXJyb3JfdGhyb3duKTtcbiAgICAgIFxuICAgICAgLy8gY3JlYXRlIGFuZCBkaXNwbGF5IGVycm9yIG1lc3NhZ2VcbiAgICAgIHZhciBtZXNzYWdlID0gQnNpZnkudHJhbnNsYXRpb25zLnByb2R1Y3QuYWZ0ZXJfcHJvZHVjdF9hZGRlZF9lcnJvcl9tZXNzYWdlX2h0bWwucmVwbGFjZSgnW2l0ZW1fdGl0bGVdJywgaXRlbV90aXRsZSkucmVwbGFjZSgnW2Vycm9yX21lc3NhZ2VdJywgZXJyb3JfdGhyb3duKTtcbiAgICAgIENhcnQuc2hvd19tZXNzYWdlKCRwcm9kdWN0X2Zvcm1fbWVzc2FnZV9lbGUsICdlcnJvcicsIG1lc3NhZ2UpO1xuICAgICAgXG4gICAgICAvLyB1cGRhdGUgYWRkIHRvIGNhcnQgYnV0dG9uIHRleHRcbiAgICAgICRwcm9kdWN0X2Zvcm1fYnV0dG9uLnZhbChCc2lmeS50cmFuc2xhdGlvbnMucHJvZHVjdC51bmF2YWlsYWJsZV9idXR0b25fdGV4dCk7XG4gICAgfVxuICB9KTtcbn07XG5cbkNhcnQucmVtb3ZlX2l0ZW1fZnJvbV9jYXJ0ID0gZnVuY3Rpb24gKCRjdXJyZW50X3RhcmdldCkge1xuICB2YXIgJGNhcnRfaXRlbV9lbGUgPSAkY3VycmVudF90YXJnZXQuY2xvc2VzdChCc2lmeS5zZWxlY3RvcnMuY2FydC5pdGVtX3NlbGVjdG9yKTtcbiAgXG4gIHZhciBpdGVtID0gQ2FydC5nZXRfaXRlbV9ieV9pZCgkY2FydF9pdGVtX2VsZS5kYXRhKCdjYXJ0LWl0ZW0nKSk7XG4gIHZhciBpdGVtX3RpdGxlID0gaXRlbS5wcm9kdWN0X3RpdGxlICsgQnNpZnkudHJhbnNsYXRpb25zLnByb2R1Y3QuaXRlbV90aXRsZV9zZXBlcmF0b3IgKyBpdGVtLnZhcmlhbnRfdGl0bGU7XG4gIFxuICBDYXJ0SlMucmVtb3ZlSXRlbSgkY3VycmVudF90YXJnZXQuZGF0YSgncmVtb3ZlLWl0ZW0nKSwge1xuICAgIFwic3VjY2Vzc1wiOiBmdW5jdGlvbiAoZGF0YSwgdGV4dF9zdGF0dXMsIGpxWEhSKSB7XG4gICAgICAvLyBoaWRlIGl0ZW0gcm93XG4gICAgICAkY2FydF9pdGVtX2VsZS5oaWRlKCk7XG4gICAgICBcbiAgICAgIC8vIFNob3cgdXNlciBhIG5pY2UgbWVzc2FnZVxuICAgICAgdmFyIG1lc3NhZ2UgPSBCc2lmeS50cmFuc2xhdGlvbnMuY2FydC5yZW1vdmVfaXRlbV9tZXNzYWdlLnJlcGxhY2UoJ1tpdGVtX3RpdGxlXScsIGl0ZW1fdGl0bGUpO1xuICAgICAgQ2FydC5zaG93X21lc3NhZ2UoJGNhcnRfbWVzc2FnZV9lbGUsICdzdWNjZXNzJywgbWVzc2FnZSk7XG4gICAgICBcbiAgICB9LFxuICAgIFwiZXJyb3JcIjogZnVuY3Rpb24gKGpxWEhSLCB0ZXh0X3N0YXR1cywgZXJyb3JfdGhyb3duKSB7XG4gICAgICBjb25zb2xlLmxvZygnW0VSUk9SXSAtIFJlbW92ZSBpdGVtIGZyb20gY2FydDonLCBqcVhIUiwgdGV4dF9zdGF0dXMsIGVycm9yX3Rocm93bm4pO1xuICAgICAgXG4gICAgICAvLyBTaG93IHVzZXIgYSBuaWNlIG1lc3NhZ2VcbiAgICAgIHZhciBtZXNzYWdlID0gQnNpZnkudHJhbnNsYXRpb25zLmNhcnQucmVtb3ZlX2l0ZW1fZXJyb3JfbWVzc2FnZS5yZXBsYWNlKCdbaXRlbV90aXRsZV0nLCBpdGVtX3RpdGxlKS5yZXBsYWNlKCdbZXJyb3JfbWVzc2FnZV0nLCBlcnJvcl90aHJvd24pO1xuICAgICAgQ2FydC5zaG93X21lc3NhZ2UoJGNhcnRfbWVzc2FnZV9lbGUsICdzdWNjZXNzJywgbWVzc2FnZSk7XG4gICAgfSBcbiAgfSk7XG59O1xuXG4vKlxuICBEaXNwbGF5IG1ldGhvZHNcbiovXG5cbi8vIFVwZGF0ZSBjYXJ0IGRpc3BsYXkgd2l0aCB0aGUgY3VycmVudCBjYXJ0IGRldGFpbHNcbkNhcnQudXBkYXRlX2NhcnRfZGlzcGxheSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNhcnRfdG90YWxfcHJpY2UgPSBTaG9waWZ5LmZvcm1hdE1vbmV5KENhcnRKUy5jYXJ0LnRvdGFsX3ByaWNlLCBCc2lmeS5tb25leV9mb3JtYXRzLm1vbmV5Rm9ybWF0KTtcbiAgdmFyIGNhcnRfdG90YWxfcHJpY2Vfd2l0aF9jdXJyZW5jeSA9IFNob3BpZnkuZm9ybWF0TW9uZXkoQ2FydEpTLmNhcnQudG90YWxfcHJpY2UsIEJzaWZ5Lm1vbmV5X2Zvcm1hdHMubW9uZXlXaXRoQ3VycmVuY3lGb3JtYXQpO1xuICB2YXIgY2FydF9kaXNwbGF5X3RleHQgPSBCc2lmeS50cmFuc2xhdGlvbnMuY2FydC5jYXJ0X2Rpc3BsYXlfdGV4dC5yZXBsYWNlKCdbaXRlbV9jb3VudF0nLCBDYXJ0SlMuY2FydC5pdGVtX2NvdW50KS5yZXBsYWNlKCdbY2FydF90b3RhbF9wcmljZV0nLCBjYXJ0X3RvdGFsX3ByaWNlKS5yZXBsYWNlKCdbY2FydF90b3RhbF9wcmljZV93aXRoX2N1cnJlbmN5XScsIGNhcnRfdG90YWxfcHJpY2Vfd2l0aF9jdXJyZW5jeSk7XG4gICRjYXJ0X2Rpc3BsYXlfZWxlLmh0bWwoY2FydF9kaXNwbGF5X3RleHQpO1xufTtcblxuLy8gaGlkZSB0aGUgY2FydCB0YWJsZSBpZiB0aGUgY2FydCBpcyBlbXB0eVxuQ2FydC51cGRhdGVfY2FydF90YWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKENhcnRKUy5jYXJ0Lml0ZW1fY291bnQgPT09IDApIHtcbiAgICAkY2FydF90YWJsZV9lbGUuaGlkZSgpO1xuICAgICRjYXJ0X21lc3NhZ2VfZWxlLnJlbW92ZUNsYXNzKCdoaWRkZW4nKS5odG1sKEJzaWZ5LnRyYW5zbGF0aW9ucy5jYXJ0LmVtcHR5X2NhcnRfdGV4dCk7XG4gIH1cbn07XG5cbi8vIHNob3cgYW5kIGhpZGUgZmVlZGJhY2sgbWVzYWdlcyBmb3IgY2FydCBhY3Rpb25zXG5DYXJ0LnNob3dfbWVzc2FnZSA9IGZ1bmN0aW9uICgkbWVzc2FnZV9lbGUsIG1lc3NhZ2VfY2xhc3MsIG1lc3NhZ2UpIHtcbiAgbWVzc2FnZV9jb3VudCsrO1xuICAkbWVzc2FnZV9lbGUucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpLmh0bWwoJzxkaXYgY2xhc3M9XCJub3RlICcrbWVzc2FnZV9jbGFzcysnIG1lc3NhZ2UnK21lc3NhZ2VfY291bnQrJ1wiPicrbWVzc2FnZSsnPC9kaXY+Jyk7XG4gIENhcnQucmVtb3ZlX21lc3NhZ2UobWVzc2FnZV9jb3VudCk7XG59O1xuXG5DYXJ0LnJlbW92ZV9tZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2VfaWQpIHtcbiAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgJCgnLm1lc3NhZ2UnK21lc3NhZ2VfaWQpLmZhZGVPdXQoZnVuY3Rpb24gKCkge1xuICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICB9KTtcbiAgfSwgQnNpZnkubWVzc2FnZV90aW1lb3V0KTtcbn07XG5cbi8vIGNvbnZlcnQgalF1ZXJ5IHNlcmlhbGl6ZUFycmF5IHJlc3VsdHMgaW50byBzb21ldGhpbmcgdXNlZnVsIFxuQ2FydC5mb3JtX3ZhbHVlcyA9IGZ1bmN0aW9uIChhcnIpIHtcbiAgdmFyIHZhbHMgPSB7fTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgaXRlbSA9IGFycltpXTtcbiAgICB2YWxzW2l0ZW0ubmFtZV0gPSBpdGVtLnZhbHVlO1xuICB9XG4gIHJldHVybiB2YWxzO1xufTtcblxuLypcbiAgQ2FydCB1dGlsaXR5IGZ1bmN0aW9uc1xuKi9cblxuLy8gR2V0IGl0ZW0gZnJvbSBDYXJ0SlMgYnkgdmFyaWFudCBpZFxuQ2FydC5nZXRfaXRlbV9ieV9pZCA9IGZ1bmN0aW9uICh2YXJpYW50X2lkKSB7XG4gIGlmICh0eXBlb2YgdmFyaWFudF9pZCA9PT0gJ3N0cmluZycpIHZhcmlhbnRfaWQgPSBwYXJzZUludCh2YXJpYW50X2lkKTtcbiAgdmFyIGxpbmVfaXRlbTtcbiAgaWYgKENhcnRKUykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQ2FydEpTLmNhcnQuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBpdGVtID0gQ2FydEpTLmNhcnQuaXRlbXNbaV07XG4gICAgICBpZiAoaXRlbS52YXJpYW50X2lkID09PSB2YXJpYW50X2lkKSB7XG4gICAgICAgIGxpbmVfaXRlbSA9IGl0ZW07XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBsaW5lX2l0ZW07XG59O1xuXG4vLyBDaGVjayBjYXJ0IGZvciB2YXJpYW50XG5DYXJ0Lmhhc192YXJpYW50ID0gZnVuY3Rpb24gKHZhcmlhbnRfaWQpIHtcbiAgaWYgKHR5cGVvZiB2YXJpYW50X2lkID09PSAnc3RyaW5nJykgdmFyaWFudF9pZCA9IHBhcnNlSW50KHZhcmlhbnRfaWQpO1xuICB2YXIgaGFzX3ZhcmlhbnQgPSBmYWxzZTtcbiAgaWYgKENhcnRKUykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQ2FydEpTLmNhcnQuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBpdGVtID0gQ2FydEpTLmNhcnQuaXRlbXNbaV07XG4gICAgICBpZiAoaXRlbS52YXJpYW50X2lkID09PSB2YXJpYW50X2lkKSB7XG4gICAgICAgIGhhc192YXJpYW50ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGhhc192YXJpYW50O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDYXJ0OyIsInZhciBJbWFnZVN3aXRjaGVyID0ge307XG5cbi8vIE5PVEU6IGhvdyB3aWxsIHRoaXMgYWxsIHdvcmsgd2l0aCBzcmNzZXQgPz8hIVxuLy8gVE9ETzogc3dpcGUgYmV0d2VlbiBpbWFnZXMgb24gbW9iaWxlXG5cbi8vIFByZWxvYWQgaW1hZ2VzIGZvciBnYWxsZXJ5XG4vLyBVc2VkIHRoZSBzaXplZCBzcmNcbkltYWdlU3dpdGNoZXIucHJlbG9hZF9wcm9kdWN0X3RodW1icyA9IGZ1bmN0aW9uKCl7XG4gIHZhciAkdGh1bWJzID0gJCgnW2RhdGEtZ2FsbGVyeS1tYWluXScpO1xuICB2YXIgbWFpbl9pbWFnZV9lbGVtZW50ID0gJCgkdGh1bWJzLmRhdGEoJ2dhbGxlcnktbWFpbicpKVswXTtcbiAgdmFyIG1haW5faW1hZ2Vfc2l6ZSA9IFNob3BpZnkuSW1hZ2UuaW1hZ2VTaXplKG1haW5faW1hZ2VfZWxlbWVudC5zcmMpO1xuICBcbiAgaWYoJHRodW1icy5sZW5ndGggPiAwKXtcbiAgICAkdGh1bWJzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgIHZhciBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgdmFyIHNyYyA9ICQodGhpcykuYXR0cignaHJlZicpO1xuICAgICAgdmFyIHNpemVkX3NyYyA9IFNob3BpZnkuSW1hZ2UuZ2V0U2l6ZWRJbWFnZVVybChzcmMsIG1haW5faW1hZ2Vfc2l6ZSk7XG4gICAgICBpbWFnZS5zcmMgPSBzaXplZF9zcmM7XG4gICAgfSk7XG4gIH1cbn07XG5cbi8vIEluaXRpYWxpc2UgdGhlIGltYWdlIHN3aXRjaGVyIGZvciBnYWxsZXJ5IHRodW1ic1xuSW1hZ2VTd2l0Y2hlci5pbWFnZV9zd3RpY2hlciA9IGZ1bmN0aW9uICgpIHtcbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLWdhbGxlcnktbWFpbl0nLCBmdW5jdGlvbiAoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB2YXIgJGN1cnJlbnRfdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgIHZhciBtYWluX2ltYWdlX2VsZW1lbnQgPSAkKCRjdXJyZW50X3RhcmdldC5kYXRhKCdnYWxsZXJ5LW1haW4nKSlbMF07XG4gICAgdmFyIGltYWdlX3NyYyA9ICRjdXJyZW50X3RhcmdldC5hdHRyKCdocmVmJyk7XG4gICAgSW1hZ2VTd2l0Y2hlci5zd2l0Y2hfaW1hZ2UobWFpbl9pbWFnZV9lbGVtZW50LCBpbWFnZV9zcmMpO1xuICB9KTtcbn07XG5cbi8vIFN3aXRjaCBpbWFnZVxuLy8gLSB0YWtlcyB0aGUgbWFpbiBpbWFnZSBlbGVtZW50IHRoYXQgd2lsbCBoYXZlIGl0J3Mgc3JjIGNoYW5nZWRcbi8vIC0gYW5kIHRoZSBuZXcgc3JjIHRvIGNoYW5nZSBpdCB0b1xuSW1hZ2VTd2l0Y2hlci5zd2l0Y2hfaW1hZ2UgPSBmdW5jdGlvbiAobWFpbl9pbWFnZV9lbGVtZW50LCBpbWFnZV9zcmMpIHtcbiAgaWYgKCFtYWluX2ltYWdlX2VsZW1lbnQgfHwgIWltYWdlX3NyYykge1xuICAgIHJldHVybjtcbiAgfVxuICAvLyBnZXQgdGhlIG5ldyBpbWFnZSBzcmMgYXQgdGhlIGNvcnJlY3Qgc2l6ZVxuICB2YXIgbWFpbl9pbWFnZV9zaXplID0gU2hvcGlmeS5JbWFnZS5pbWFnZVNpemUobWFpbl9pbWFnZV9lbGVtZW50LnNyYyk7XG4gIHZhciBuZXdfaW1hZ2Vfc3JjID0gU2hvcGlmeS5JbWFnZS5nZXRTaXplZEltYWdlVXJsKGltYWdlX3NyYywgbWFpbl9pbWFnZV9zaXplKTtcbiAgLy8gc3dpdGNoIHRoZSBtYWluIGltYWdlIHRvIHRoZSBuZXcgc3JjXG4gIGlmIChtYWluX2ltYWdlX2VsZW1lbnQuc3JjICE9PSBuZXdfaW1hZ2Vfc3JjKSB7XG4gICAgbWFpbl9pbWFnZV9lbGVtZW50LnNyYyA9IG5ld19pbWFnZV9zcmM7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gSW1hZ2VTd2l0Y2hlcjsiLCIvLyBDb2xsZWN0IHRoZSBCc2lmeSBvYmplY3QgZnJvbSB0aGUgd2luZG93IHdpdGggb3VyIHRyYW5zbGF0aW9ucyBhbmQgbGlxdWlkIHZhcmlhYmxlcyBhbGwgc2V0IHVwXG52YXIgQnNpZnkgPSB3aW5kb3cuQnNpZnkgfHwge307XG5cbi8qXG4gIEJvb3RzdHJhcGlmeSB1dGlsaXR5IG1ldGhvZHNcbiovXG5cbkJzaWZ5LmdldF92YXJpYW50X2J5X2lkID0gZnVuY3Rpb24gKHZhcmlhbnRfaWQpIHtcbiAgdmFyIHNlbGVjdGVkX3ZhcmlhbnQ7XG4gIGlmICh0eXBlb2YgdmFyaWFudF9pZCA9PT0gJ3N0cmluZycpIHZhcmlhbnRfaWQgPSBwYXJzZUludCh2YXJpYW50X2lkKTtcbiAgXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgQnNpZnkucHJvZHVjdC52YXJpYW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciB2YXJpYW50ID0gQnNpZnkucHJvZHVjdC52YXJpYW50c1tpXTtcbiAgICBpZiAodmFyaWFudC5pZCA9PT0gdmFyaWFudF9pZCkge1xuICAgICAgc2VsZWN0ZWRfdmFyaWFudCA9IHZhcmlhbnQ7XG4gICAgfVxuICB9XG4gIHJldHVybiBzZWxlY3RlZF92YXJpYW50O1xufTtcblxuLy8gYWRkIGJzaWZ5IGNsYXNzZXMgdG8gdGhlIEJzaWZ5IG9iamVjdFxuQnNpZnkuQ2FydCA9IHJlcXVpcmUoJy4vYnNpZnkuY2FydC5qcycpO1xuQnNpZnkuSW1hZ2VTd2l0Y2hlciA9IHJlcXVpcmUoJy4vYnNpZnkuaW1hZ2Vfc3dpdGNoZXIuanMnKTtcbkJzaWZ5LlZhcmlhbnRPcHRpb25Td2l0Y2hlciA9IHJlcXVpcmUoJy4vYnNpZnkudmFyaWFudF9vcHRpb25fc3dpdGNoZXIuanMnKTtcbkJzaWZ5LkxpbmtlZFByb2R1Y3RPcHRpb25zID0gcmVxdWlyZSgnLi9ic2lmeS5saW5rZWRfcHJvZHVjdF9vcHRpb25zLmpzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gQnNpZnk7IiwiLy8gKGMpIENvcHlyaWdodCAyMDE0IENhcm9saW5lIFNjaG5hcHAuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuIENvbnRhY3Q6IG1sbGVnZW9yZ2VzYW5kQGdtYWlsLmNvbVxuLy8gU2VlIGh0dHA6Ly9kb2NzLnNob3BpZnkuY29tL21hbnVhbC9jb25maWd1cmF0aW9uL3N0b3JlLWN1c3RvbWl6YXRpb24vYWR2YW5jZWQtbmF2aWdhdGlvbi9saW5rZWQtcHJvZHVjdC1vcHRpb25zXG4vLyBNb2RpZmllZCBmb3IgdXNlIHdpdGggQm9vdHN0cmFwaWZ5NCBieSBMdWNpZCAtIDAzLzIwMTVcblxudmFyIExpbmtlZFByb2R1Y3RPcHRpb25zID0ge307XG5MaW5rZWRQcm9kdWN0T3B0aW9ucy5vcHRpb25zTWFwID0ge307XG5cbkxpbmtlZFByb2R1Y3RPcHRpb25zLnVwZGF0ZU9wdGlvbnNJblNlbGVjdG9yID0gZnVuY3Rpb24oc2VsZWN0b3JJbmRleCkge1xuICB2YXIga2V5LCBzZWxlY3RvcjtcbiAgICBcbiAgc3dpdGNoIChzZWxlY3RvckluZGV4KSB7XG4gICAgY2FzZSAwOlxuICAgICAga2V5ID0gJ3Jvb3QnO1xuICAgICAgc2VsZWN0b3IgPSBqUXVlcnkoJy5zaW5nbGUtb3B0aW9uLXNlbGVjdG9yOmVxKDApJyk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDE6XG4gICAgICBrZXkgPSBqUXVlcnkoJy5zaW5nbGUtb3B0aW9uLXNlbGVjdG9yOmVxKDApJykudmFsKCk7XG4gICAgICBzZWxlY3RvciA9IGpRdWVyeSgnLnNpbmdsZS1vcHRpb24tc2VsZWN0b3I6ZXEoMSknKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMjpcbiAgICAgIGtleSA9IGpRdWVyeSgnLnNpbmdsZS1vcHRpb24tc2VsZWN0b3I6ZXEoMCknKS52YWwoKTsgIFxuICAgICAga2V5ICs9ICcgLyAnICsgalF1ZXJ5KCcuc2luZ2xlLW9wdGlvbi1zZWxlY3RvcjplcSgxKScpLnZhbCgpO1xuICAgICAgc2VsZWN0b3IgPSBqUXVlcnkoJy5zaW5nbGUtb3B0aW9uLXNlbGVjdG9yOmVxKDIpJyk7XG4gIH1cbiAgXG4gIHZhciBpbml0aWFsVmFsdWUgPSBzZWxlY3Rvci52YWwoKTtcbiAgc2VsZWN0b3IuZW1wdHkoKTsgICAgXG4gIHZhciBhdmFpbGFibGVPcHRpb25zID0gTGlua2VkUHJvZHVjdE9wdGlvbnMub3B0aW9uc01hcFtrZXldO1xuICBpZiAoYXZhaWxhYmxlT3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZm9yICh2YXIgaT0wOyBpPGF2YWlsYWJsZU9wdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBvcHRpb24gPSBhdmFpbGFibGVPcHRpb25zW2ldO1xuICAgICAgdmFyIG5ld09wdGlvbiA9IGpRdWVyeSgnPG9wdGlvbj48L29wdGlvbj4nKS52YWwob3B0aW9uKS5odG1sKG9wdGlvbik7XG4gICAgICBzZWxlY3Rvci5hcHBlbmQobmV3T3B0aW9uKTtcbiAgICB9XG4gICAgalF1ZXJ5KCcuc3dhdGNoW2RhdGEtb3B0aW9uLWluZGV4PVwiJyArIHNlbGVjdG9ySW5kZXggKyAnXCJdIC5zd2F0Y2gtZWxlbWVudCcpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoalF1ZXJ5LmluQXJyYXkoJCh0aGlzKS5hdHRyKCdkYXRhLXZhbHVlJyksIGF2YWlsYWJsZU9wdGlvbnMpICE9PSAtMSkge1xuICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdzb2xkb3V0Jykuc2hvdygpLmZpbmQoJzpyYWRpbycpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJywnZGlzYWJsZWQnKS5yZW1vdmVBdHRyKCdjaGVja2VkJyk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnc29sZG91dCcpLmhpZGUoKS5maW5kKCc6cmFkaW8nKS5yZW1vdmVBdHRyKCdjaGVja2VkJykuYXR0cignZGlzYWJsZWQnLCdkaXNhYmxlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChqUXVlcnkuaW5BcnJheShpbml0aWFsVmFsdWUsIGF2YWlsYWJsZU9wdGlvbnMpICE9PSAtMSkge1xuICAgICAgc2VsZWN0b3IudmFsKGluaXRpYWxWYWx1ZSk7XG4gICAgfVxuICAgIHNlbGVjdG9yLnRyaWdnZXIoJ2NoYW5nZScpO1xuICB9XG59O1xuXG5MaW5rZWRQcm9kdWN0T3B0aW9ucy5saW5rT3B0aW9uU2VsZWN0b3JzID0gZnVuY3Rpb24ocHJvZHVjdCkge1xuICAvLyBCdWlsZGluZyBvdXIgbWFwcGluZyBvYmplY3QuXG4gIGZvciAodmFyIGk9MDsgaTxwcm9kdWN0LnZhcmlhbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHZhcmlhbnQgPSBwcm9kdWN0LnZhcmlhbnRzW2ldO1xuICAgIGlmICh2YXJpYW50LmF2YWlsYWJsZSkge1xuICAgICAgdmFyIGtleTtcbiAgICAgIC8vIEdhdGhlcmluZyB2YWx1ZXMgZm9yIHRoZSAxc3QgZHJvcC1kb3duLlxuICAgICAgTGlua2VkUHJvZHVjdE9wdGlvbnMub3B0aW9uc01hcC5yb290ID0gTGlua2VkUHJvZHVjdE9wdGlvbnMub3B0aW9uc01hcC5yb290IHx8IFtdO1xuICAgICAgTGlua2VkUHJvZHVjdE9wdGlvbnMub3B0aW9uc01hcC5yb290LnB1c2godmFyaWFudC5vcHRpb24xKTtcbiAgICAgIExpbmtlZFByb2R1Y3RPcHRpb25zLm9wdGlvbnNNYXAucm9vdCA9IFNob3BpZnkudW5pcShMaW5rZWRQcm9kdWN0T3B0aW9ucy5vcHRpb25zTWFwLnJvb3QpO1xuICAgICAgLy8gR2F0aGVyaW5nIHZhbHVlcyBmb3IgdGhlIDJuZCBkcm9wLWRvd24uXG4gICAgICBpZiAocHJvZHVjdC5vcHRpb25zLmxlbmd0aCA+IDEpIHtcbiAgICAgICAga2V5ID0gdmFyaWFudC5vcHRpb24xO1xuICAgICAgICBMaW5rZWRQcm9kdWN0T3B0aW9ucy5vcHRpb25zTWFwW2tleV0gPSBMaW5rZWRQcm9kdWN0T3B0aW9ucy5vcHRpb25zTWFwW2tleV0gfHwgW107XG4gICAgICAgIExpbmtlZFByb2R1Y3RPcHRpb25zLm9wdGlvbnNNYXBba2V5XS5wdXNoKHZhcmlhbnQub3B0aW9uMik7XG4gICAgICAgIExpbmtlZFByb2R1Y3RPcHRpb25zLm9wdGlvbnNNYXBba2V5XSA9IFNob3BpZnkudW5pcShMaW5rZWRQcm9kdWN0T3B0aW9ucy5vcHRpb25zTWFwW2tleV0pO1xuICAgICAgfVxuICAgICAgLy8gR2F0aGVyaW5nIHZhbHVlcyBmb3IgdGhlIDNyZCBkcm9wLWRvd24uXG4gICAgICBpZiAocHJvZHVjdC5vcHRpb25zLmxlbmd0aCA9PT0gMykge1xuICAgICAgICBrZXkgPSB2YXJpYW50Lm9wdGlvbjEgKyAnIC8gJyArIHZhcmlhbnQub3B0aW9uMjtcbiAgICAgICAgTGlua2VkUHJvZHVjdE9wdGlvbnMub3B0aW9uc01hcFtrZXldID0gTGlua2VkUHJvZHVjdE9wdGlvbnMub3B0aW9uc01hcFtrZXldIHx8IFtdO1xuICAgICAgICBMaW5rZWRQcm9kdWN0T3B0aW9ucy5vcHRpb25zTWFwW2tleV0ucHVzaCh2YXJpYW50Lm9wdGlvbjMpO1xuICAgICAgICBMaW5rZWRQcm9kdWN0T3B0aW9ucy5vcHRpb25zTWFwW2tleV0gPSBTaG9waWZ5LnVuaXEoTGlua2VkUHJvZHVjdE9wdGlvbnMub3B0aW9uc01hcFtrZXldKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLy8gVXBkYXRlIG9wdGlvbnMgcmlnaHQgYXdheS5cbiAgTGlua2VkUHJvZHVjdE9wdGlvbnMudXBkYXRlT3B0aW9uc0luU2VsZWN0b3IoMCk7XG4gIGlmIChwcm9kdWN0Lm9wdGlvbnMubGVuZ3RoID4gMSkgTGlua2VkUHJvZHVjdE9wdGlvbnMudXBkYXRlT3B0aW9uc0luU2VsZWN0b3IoMSk7XG4gIGlmIChwcm9kdWN0Lm9wdGlvbnMubGVuZ3RoID09PSAzKSBMaW5rZWRQcm9kdWN0T3B0aW9ucy51cGRhdGVPcHRpb25zSW5TZWxlY3RvcigyKTtcbiAgLy8gV2hlbiB0aGVyZSBpcyBhbiB1cGRhdGUgaW4gdGhlIGZpcnN0IGRyb3Bkb3duLlxuICBqUXVlcnkoXCIuc2luZ2xlLW9wdGlvbi1zZWxlY3RvcjplcSgwKVwiKS5jaGFuZ2UoZnVuY3Rpb24oKSB7XG4gICAgTGlua2VkUHJvZHVjdE9wdGlvbnMudXBkYXRlT3B0aW9uc0luU2VsZWN0b3IoMSk7XG4gICAgaWYgKHByb2R1Y3Qub3B0aW9ucy5sZW5ndGggPT09IDMpIExpbmtlZFByb2R1Y3RPcHRpb25zLnVwZGF0ZU9wdGlvbnNJblNlbGVjdG9yKDIpO1xuICAgIHJldHVybiB0cnVlO1xuICB9KTtcbiAgLy8gV2hlbiB0aGVyZSBpcyBhbiB1cGRhdGUgaW4gdGhlIHNlY29uZCBkcm9wZG93bi5cbiAgalF1ZXJ5KFwiLnNpbmdsZS1vcHRpb24tc2VsZWN0b3I6ZXEoMSlcIikuY2hhbmdlKGZ1bmN0aW9uKCkge1xuICAgIGlmIChwcm9kdWN0Lm9wdGlvbnMubGVuZ3RoID09PSAzKSBMaW5rZWRQcm9kdWN0T3B0aW9ucy51cGRhdGVPcHRpb25zSW5TZWxlY3RvcigyKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSk7XG4gIFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBMaW5rZWRQcm9kdWN0T3B0aW9uczsiLCJ2YXIgVmFyaWFudE9wdGlvblN3aXRjaGVyID0ge307XG5cbi8vIFN3aXRjaCB0aGUgdmFyaWFudCBpZiB0aGUgZ2FsbGVyeSB0aHVtYiBpcyBsaW5rZWQgdG8gb25lXG5WYXJpYW50T3B0aW9uU3dpdGNoZXIuaW1hZ2VfdmFyaWFudF9zd2l0Y2hlciA9IGZ1bmN0aW9uICgpIHtcbiAgXG4gIHZhciAkcHJvZHVjdF9zZWxlY3RvciA9ICQoQnNpZnkuc2VsZWN0b3JzLnByb2R1Y3Quc2VsZWN0X3NlbGVjdG9yKTtcbiAgXG4gICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdbZGF0YS12YXJpYW50LWlkXScsIGZ1bmN0aW9uIChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHZhciAkY3VycmVudF90YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgLy8gdXBkYXRlIHRoZSBwcm9kdWN0IHNlbGVjdG9yIHdpdGggdGhlIG5ldyB2YXJpYW50IGlkXG4gICAgJHByb2R1Y3Rfc2VsZWN0b3IudmFsKCRjdXJyZW50X3RhcmdldC5kYXRhKCd2YXJpYW50LWlkJykpO1xuICAgIC8vIHVwZGF0ZSB0aGUgb3B0aW9uIHNlbGVjdG9yc1xuICAgIFZhcmlhbnRPcHRpb25Td2l0Y2hlci51cGRhdGVfcHJvZHVjdF9zZWxlY3Rvcl9vcHRpb25zKCRwcm9kdWN0X3NlbGVjdG9yKTtcbiAgfSk7XG59O1xuXG4vLyBNYWtlIHRoZSBvcmlnaW5hbCB2YXJpYW50IHNlbGVjdG9yIHVwZGF0ZSB0aGUgZ2VuZXJhdGVkIG9wdGlvbiBzZWxlY3RvcnNcbi8vIHdlIGFyZSBub3QgZG9pbmcgdGhpcyBvbiBhIHRyaWdnZXIgZXZlbnQgYmVjYXVzZSBpZiB3ZSBkaWQgd2UnZCBlbmQgdXAgaW4gcmVjdXJzaXZlIGhlbGxcblZhcmlhbnRPcHRpb25Td2l0Y2hlci51cGRhdGVfcHJvZHVjdF9zZWxlY3Rvcl9vcHRpb25zID0gZnVuY3Rpb24gKCRwcm9kdWN0X3NlbGVjdG9yKSB7XG4gIFxuICAvLyBnZXQgdGhlIHNlbGVjdGVkIHZhcmlhbnQgb2JqZWN0XG4gIHZhciB2YXJpYW50X2lkID0gJHByb2R1Y3Rfc2VsZWN0b3IudmFsKCk7XG4gIHZhciB2YXJpYW50ID0gQnNpZnkuZ2V0X3ZhcmlhbnRfYnlfaWQodmFyaWFudF9pZCk7XG4gIFxuICBpZiAodmFyaWFudCkge1xuICAgIC8vIHVwZGF0ZSBlYWNoIG9wdGlvbiBzZWxlY3RvclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQnNpZnkucHJvZHVjdC5vcHRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgb3B0aW9uID0gJ29wdGlvbicrKGkrMSk7XG4gICAgICB2YXIgdmFsdWUgPSB2YXJpYW50W29wdGlvbl07XG4gICAgICAkKCcuc2luZ2xlLW9wdGlvbi1zZWxlY3RvcjplcSgnK2krJyknKS52YWwodmFsdWUpLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgIH1cbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBWYXJpYW50T3B0aW9uU3dpdGNoZXI7Il19
